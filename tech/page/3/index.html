<!doctype html><html lang=zh-tw itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>ProgramMur - 程序猿碎念 - </title><meta name=author content="androchentw"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"ProgramMur - 程序猿碎念","url":"https:\/\/blog.androchen.tw\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/blog.androchen.tw\/"}</script><meta property="og:title" content=" | ProgramMur - 程序猿碎念"><meta property="og:image" content="https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume.jpg?raw=true"><meta property="og:url" content="https://blog.androchen.tw/tech/"><meta property="og:type" content="website"><meta property="og:site_name" content="ProgramMur - 程序猿碎念"><meta name=twitter:title content="ProgramMur - 程序猿碎念"><meta name=twitter:image content="https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume-square.jpg?raw=true"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ProgramMurTw"><meta name=twitter:creator content="@ProgramMurTw"><link href='https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume-square.jpg?raw=true' rel=icon type=image/x-icon><meta name=generator content="Hugo 0.136.4"><link rel=alternate href=https://blog.androchen.tw/index.xml type=application/rss+xml title="ProgramMur - 程序猿碎念"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://blog.androchen.tw/css/main-nodark.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://blog.androchen.tw/css/syntax.css><link rel=stylesheet href=https://blog.androchen.tw/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=G-PN5YM4PWN6"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PN5YM4PWN6")}</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>開關導覽</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://blog.androchen.tw/>ProgramMur - 程序猿碎念</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Tech href=/tech/>Tech</a></li><li><a title=Soft href=/soft/>Soft</a></li><li><a title=Life href=/life/>Life</a></li><li><a title=Series href=/series/>Series</a></li><li><a title=Tags href=/tags/>Tags</a></li><li><a title=Archives href=/archives/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>🌐 語言</a><div class=navlinks-children><a href=https://blog.androchen.tw/en/tech/>🇺🇸 English</a>
<a href=https://blog.androchen.tw/ja/tech/>🇯🇵 日本語</a></div></li><li><a href=#modalSearch data-toggle=modal data-target=#modalSearch style=outline:none><span class="hidden-sm hidden-md hidden-lg">搜尋</span> <span id=searchGlyph class="glyphicon glyphicon-search"></span></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="ProgramMur - 程序猿碎念" href=https://blog.androchen.tw/><img class=avatar-img src="https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume-square.jpg?raw=true" alt="ProgramMur - 程序猿碎念"></a></div></div></div></nav><div id=modalSearch class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal>&#215;</button><h4 class=modal-title>搜尋 ProgramMur - 程序猿碎念</h4></div><div class=modal-body><gcse:search></gcse:search></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>關閉</button></div></div></div></div><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><div class=intro-header></div><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=posts-list><article class=post-preview><a href=https://blog.androchen.tw/python-project-structure-with-pytest/><h2 class=post-title>開箱即用的 Python 專案結構與 PyTest</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 2022-09-06
&nbsp;(最後修改於 2023-04-16)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;575&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><img style=width:60% src=https://i.imgur.com/Qe3Dzt6.png><p align=center><sub><sup>Photo by <a href="https://unsplash.com/@clemhlrdt?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Clément Hélardot</a> on <a href="https://unsplash.com/collections/SV-KO-htOoM/tech?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></sup></sub></p><h2 id=overview>Overview</h2><h3 id=challenges-現況-挑戰>Challenges 現況 挑戰</h3><ul><li>該如何設計良好可擴充的 python 專案目錄結構? 有什麼 naming convention 嗎?</li></ul><h3 id=objectives-目標-效益>Objectives 目標 效益</h3><ul><li>結合 PyTest 等各 Python Testing Framework, 研究並建立一個 Python Project 範本, 方便未來直接使用及擴充</li></ul><h3 id=krs-結果-解法>KRs 結果 解法</h3><ul><li><input disabled type=checkbox> 2022-09-09: 優化 <a href=https://github.com/androchentw/python-playground>python-playground</a> 的目錄結構. 詳見 <a href=https://blog.androchen.tw/github-python-playground/>Github - Python Playground</a></li></ul><a href=https://blog.androchen.tw/python-project-structure-with-pytest/ class=post-read-more>[閱讀全文]</a></div><div class=blog-tags><a href=https://blog.androchen.tw/tags/testing/>testing</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.androchen.tw/agile-summit-2022/><h2 class=post-title>Agile Summit 2022 敏捷高峰盛會 - VUCA 時代敏捷導入 + 持續交付價值</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 2022-09-02
&nbsp;(最後修改於 2024-09-14)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;3926&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><img style=width:60% src=https://agile.ithome.com.tw/2022/img/kv-txt.svg><h2 id=overview>Overview</h2><p>同場加映: <a href=https://blog.androchen.tw/devopsdays-taipei-2022/>DevOpsDays Taipei 2022 - 企業 IT 數位轉型投資成長 + 持續交付高品質可用產品</a></p><ul><li>Why 為什麼要敏捷<ul><li>應變 Uncertainty 不確定性 (需求, User, 環境, &mldr;)</li><li>痛點 = 交付週期長, 重工的浪費</li></ul></li><li>How 如何敏捷<ul><li>小增量, 多迭代, 尋求回饋 => 持續交付價值</li><li>「趕快錯, 趕快做, 趕快改」</li><li>持續學習</li><li>分析 價值流 & 產品開發週期</li><li>工具流程面上搭配 DevOps</li></ul></li><li>Common Pitfalls 常見的坑<ul><li>為敏捷而敏捷 => 敏捷是手段, 不是目的</li><li>你的敏捷不是我的敏捷 => 積極討論, 尋求共識</li><li>處理如何規模化的議題 (Agile at scale)</li></ul></li><li>精選內容<ul><li><a href=https://perryliu7106.home.blog/2022/08/31/%E5%AF%A6%E8%B8%90-devsecops%E7%9A%84%E9%97%9C%E9%8D%B5%E5%BF%83%E6%B3%95>實踐DevSecOps的關鍵心法 - 當數位轉型遇見資訊安全</a></li><li><a href=https://hackmd.io/@twdeveloper/rJM2NAByj>敏捷導入的挑戰、限制、與解藥</a></li><li><a href=https://ruddyblog.wordpress.com/>Developer eXperience 開發者體驗即學習 - RUDDY LEE 分享空間</a></li></ul></li></ul><h3 id=challenges-現況-挑戰>Challenges 現況 挑戰</h3><ul><li>需求變動快速, 如何快速應對?</li><li>專案開發/實作/推廣過程, 尚未形成足夠敏捷的交付模式</li></ul><h3 id=objectives-目標-效益>Objectives 目標 效益</h3><ul><li>Project Management: 透過參考業界經驗, 建立專案管理方法, 使專案的實作與推廣過程, 可以更敏捷</li><li>Delivery Speed & Quality: 提升交付速度, 縮短交付週期</li></ul><h3 id=krs-結果-解法>KRs 結果 解法</h3><ul><li><input checked disabled type=checkbox> 瞭解實戰推動手法 + 懶人包 => 都需要視情況調整</li><li><input checked disabled type=checkbox> 瞭解為何敏捷重要</li><li><input checked disabled type=checkbox> 瞭解如何在企業裡導入敏捷, 交付價值, 彈性拿捏</li></ul><a href=https://blog.androchen.tw/agile-summit-2022/ class=post-read-more>[閱讀全文]</a></div><div class=blog-tags><a href=https://blog.androchen.tw/tags/tech-event/>tech-event</a>&nbsp;
<a href=https://blog.androchen.tw/tags/agile/>agile</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.androchen.tw/7-types-of-software-testing-python/><h2 class=post-title>軟體測試的 7 種類型 - Python 範例程式碼</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 2022-08-28
&nbsp;(最後修改於 2023-04-16)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;3&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1436&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><img style=width:60% src=https://i.imgur.com/Qe3Dzt6.png><p align=center><sub><sup>Photo by <a href="https://unsplash.com/@clemhlrdt?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Clément Hélardot</a> on <a href="https://unsplash.com/collections/SV-KO-htOoM/tech?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></sup></sub></p><h2 id=overview>Overview</h2><p>測試種類百百種, 你測的是哪一種? 該測的又是哪一種? 讓我們來一探究竟!
本文暫不討論為何要寫測試, 效益為何. 有興趣的朋友敬請期待下一篇文章 :P</p><p>一言以蔽之就是品質. 不測試的話就只是盲目地相信自己的程式碼永遠都會正常運作. 而這個信仰通常十分薄弱, 基本上都只是落入維運時 見一個修一個, 很難查 root cause 的惡性循環.
細節就留待我最近邊學 TDD 時再來記錄囉~</p><h3 id=challenges>Challenges</h3><ul><li>測試初心者, 不確定該寫哪些測試才是有效的 (Effective & Efficient)</li></ul><h3 id=objectives>Objectives</h3><ol><li>瞭解自動化測試的類型與其定義</li><li>建立測試範例程式碼, 結合 <a href=https://blog.androchen.tw/github-python-playground/>Github - Python Playground</a></li></ol><h3 id=krs>KRs</h3><ol><li><input checked disabled type=checkbox> 2022-08/E 初版完成。</li></ol><a href=https://blog.androchen.tw/7-types-of-software-testing-python/ class=post-read-more>[閱讀全文]</a></div><div class=blog-tags><a href=https://blog.androchen.tw/tags/python/>python</a>&nbsp;
<a href=https://blog.androchen.tw/tags/testing/>testing</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.androchen.tw/github-python-playground/><h2 class=post-title>Github - Python Playground</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 2022-08-16
&nbsp;(最後修改於 2023-04-16)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;1&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;133&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><img style=width:60% src=https://i.imgur.com/Qe3Dzt6.png><p align=center><sub><sup>Photo by <a href="https://unsplash.com/@clemhlrdt?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Clément Hélardot</a> on <a href="https://unsplash.com/collections/SV-KO-htOoM/tech?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></sup></sub></p><h2 id=overview>Overview</h2><h3 id=challenges>Challenges</h3><p>不管是 SRE 或是其他簡單的小腳本，在工作上越來越多場合要開始寫 python 來自動化處理一些繁瑣的事項。</p><p>習慣性地就想要建立一個 library，邊學邊整理。</p><h3 id=objectives>Objectives</h3><ol><li>建立清楚易用的 Python Github repository as utils library.</li></ol><h3 id=krs>KRs</h3><ol><li><input checked disabled type=checkbox> 2022-08/E 初版完成。</li></ol><a href=https://blog.androchen.tw/github-python-playground/ class=post-read-more>[閱讀全文]</a></div><div class=blog-tags><a href=https://blog.androchen.tw/tags/python/>python</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.androchen.tw/golang-learn/><h2 class=post-title>Golang Learn</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 2021-07-17
&nbsp;(最後修改於 2023-04-16)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;613&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><img style=width:40% src=https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Go_Logo_Blue.svg/440px-Go_Logo_Blue.svg.png><h2 id=overview>Overview</h2><p><a href=https://blog.androchen.tw/setup-blog-hugo/>從 Ghost 搬來 Hugo 後</a>, 終於更積極地回歸 blog 了&mldr; 今天要來立下學 golang 的 flag 😂</p><p>作為新手, 條列一些觀察與期許</p><h3 id=challenges>Challenges</h3><ol><li>Profile: Data Engineer</li><li>Jobs<ol><li>Deliver data to value by designing and implementing data pipeline</li><li>Maintain operations and continuously improve service levels</li></ol></li></ol><h3 id=objectives>Objectives</h3><ol><li>Master 1 programming language to better understand the mechanism and principle of Dev & Ops .</li><li>Manage Ops in software engineering way like <a href=https://blog.androchen.tw/google-sre-books/><code>class SRE implements DevOps</code></a>.</li></ol><h3 id=krs>KRs</h3><ol><li><input disabled type=checkbox> 2021-08 Complete <a href=https://gobyexample.com/>Go by Example</a> and get familiar with VS Code extensions.</li><li><input disabled type=checkbox> 2021-09 Setup lightweight web server with modern frontend and backend framework to handle form input, api and authentication.</li></ol><a href=https://blog.androchen.tw/golang-learn/ class=post-read-more>[閱讀全文]</a></div><div class=blog-tags><a href=https://blog.androchen.tw/tags/golang/>golang</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.androchen.tw/google-sre-books/><h2 class=post-title>Google SRE Books</h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 2021-07-11
&nbsp;(最後修改於 2023-04-16)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;2&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;583&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><img style=width:40% src=https://lh3.googleusercontent.com/A-7rSIEgq-hwTETYDdYrcDQ6sftGmy0-a0LkQyvt2lrFy2p7QejyOGxhaCKDM74KmYqhqRkw63eCVfJFssRa023x0suoEgdOMZv9><h2 id=overview>Overview</h2><p>Google 推行 SRE 也已經好一陣子, 十分認同其中的各種想法與作法. 最近終於能有機會好好整理讀書心得筆記, 持續學習.</p><p>因為內容很多, 所以打算以系列文的方式, 不定期地更新內容, 這篇會作為 Summary 使用. 一來紀錄緣由, 二來追蹤進度.</p><h3 id=challenges>Challenges</h3><ol><li><strong>Hybrid Cloud Environment Complexity Grows</strong>. 身為 IT, 在 Hybrid Cloud 環境與 Micro-service 趨勢下, 帶來的是更多的 Dependency 以及更為複雜的資料流.</li><li><strong>Hard to Prove and Maintain Reliability</strong>. 在設計 Data Pipeline 的過程中, 除了最終要 Deliver Data to Value 以達到 Business Impact 外, 更需要確保每天的 Data & Services Quality & Reliability, 甚至可以說是服務上線後天天都會遇到的事.</li><li><strong>Often Without Clear Value Proposition</strong>. 而這些日常維運繁瑣的事務其實有很多可以用工程手段解決/自動化的部分, 但是卻非常容易在繁忙且接踵而來的專案下, 不自覺地疏忽了.</li><li><strong>Prioritize ITOps Tasks</strong>: 為了及早發現及早還技術債, 應該更有意識地持續分析:<ol><li>哪些該先做, 成本效益最佳?</li><li>鎖定目標後, 又該如何實作, 才能真的事半功倍?</li><li>實作完成後, 如何良好衡量優化效益?</li></ol></li></ol><h3 id=objectives>Objectives</h3><ul><li>Learn from Google SRE books<ul><li>then introduce and continuously implement and improve current data services design reliability at work.</li></ul></li></ul><h3 id=krs>KRs</h3><ol><li><input disabled type=checkbox> 2021-12 完讀 <a href=https://sre.google/workbook/table-of-contents/>The Site Reliability Workbook</a> (實作細節, 實例)</li><li><input disabled type=checkbox> 2021-12 完讀 <a href=https://sre.google/sre-book/table-of-contents/>Site Reliability Engineering</a> (概念, 文化)</li></ol><a href=https://blog.androchen.tw/google-sre-books/ class=post-read-more>[閱讀全文]</a></div><div class=blog-tags><a href=https://blog.androchen.tw/tags/sre/>sre</a>&nbsp;
<a href=https://blog.androchen.tw/tags/reading/>reading</a>&nbsp;</div></article><article class=post-preview><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-genai-cloud-run/><h2 class=post-title></h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 0001-01-01
&nbsp;(最後修改於 2024-10-24)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;14&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2878&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><h1 id=genai-cloud-run--k8s-summit-2024-gcp-workshop>GenAI Cloud Run | K8s Summit 2024 GCP Workshop</h1><h2 id=preparation>Preparation</h2><ul><li><a href=https://explore.qwiklabs.com/classrooms/16139/labs/95581>Deploy a Streamlit App Integrated with Gemini Pro on Cloud Run | GSP1229</a><ul><li><a href=https://github.com/GoogleCloudPlatform/generative-ai/blob/main/gemini/sample-apps/gemini-streamlit-cloudrun/app.py>generative-ai/gemini/sample-apps/gemini-streamlit-cloudrun/app.py</a></li></ul></li></ul><p><a href=https://deepmind.google/technologies/gemini/#introduction>Gemini</a> is a family of generative AI models developed by Google DeepMind that is designed for multimodal use cases. The Gemini API gives you access to the Gemini Pro Vision and Gemini Pro models. In this lab you will understand how to integrate Vertex AI Gemini API with applications and build and deploy the developed sample application on Google Cloud Run.</p><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-genai-cloud-run/ class=post-read-more>[閱讀全文]</a></div></article><article class=post-preview><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-otel/><h2 class=post-title></h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 0001-01-01
&nbsp;(最後修改於 2024-10-24)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;17&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;8234&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><h1 id=gcp-otel--k8s-summit-2024-gcp-workshop>GCP OTel | K8s Summit 2024 GCP Workshop</h1><p>Ref</p><ul><li><a href=https://github.com/marcustung/obervability-opentelemetry/blob/main/OpenTelemetry%20%E5%8F%AF%E8%A7%80%E6%B8%AC%E6%80%A7%E7%9A%84%E6%9C%AA%E4%BE%86.md>OpenTelemetry 可觀測性的未來</a></li></ul><h2 id=preparation>Preparation</h2><ul><li><a href=https://explore.qwiklabs.com/classrooms/16111/labs/95466>Application Monitoring with OpenTelemetry</a></li></ul><p>OpenTelemetry是CNCF推廣的<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib>容器平台監控技術</a>，針對SRE常用的Metrics, Log, 以及Trace提供了完整的支援。其廣大生態圈，不但可在無侵入的狀態下，廣泛支持各種的程式語言(e.g. Python, Java, .NET, JS等），也提供讓SRE可彈性客制監控標的。</p><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-otel/ class=post-read-more>[閱讀全文]</a></div></article><article class=post-preview><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gke-chatbot/><h2 class=post-title></h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 0001-01-01
&nbsp;(最後修改於 2024-10-24)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;4&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1568&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><h1 id=-gke-chatbot--k8s-summit-2024-gcp-workshop># GKE Chatbot | K8s Summit 2024 GCP Workshop</h1><h2 id=preparation>Preparation</h2><ul><li><a href=https://dennygoog.gitlab.io/workshops/run-gemma-chatbot-on-gke-autopilot/>Run Gemma 2 Powered Chatbot on GKE Autopilot</a><ul><li>主要使用這個頁面的 command, 僅使用 qwiklab 的資源</li></ul></li></ul><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#00688b>CLUSTER_NAME</span>=my-cluster
</span></span><span style=display:flex><span><span style=color:#00688b>CLUSTER_LOCATION</span>=us-central1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud container clusters create-auto <span style=color:#cd5555>${</span><span style=color:#00688b>CLUSTER_NAME</span><span style=color:#cd5555>}</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --location=<span style=color:#cd5555>${</span><span style=color:#00688b>CLUSTER_LOCATION</span><span style=color:#cd5555>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># kubeconfig entry generated for my-cluster.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NAME: my-cluster</span>
</span></span><span style=display:flex><span><span style=color:#228b22># LOCATION: us-central1</span>
</span></span><span style=display:flex><span><span style=color:#228b22># MASTER_VERSION: 1.30.5-gke.1014001</span>
</span></span><span style=display:flex><span><span style=color:#228b22># MASTER_IP: 34.45.80.180</span>
</span></span><span style=display:flex><span><span style=color:#228b22># MACHINE_TYPE: e2-small</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NODE_VERSION: 1.30.5-gke.1014001</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NUM_NODES: 3</span>
</span></span><span style=display:flex><span><span style=color:#228b22># STATUS: RUNNING</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info
</span></span><span style=display:flex><span><span style=color:#228b22># Kubernetes control plane is running at https://34.45.80.180</span>
</span></span><span style=display:flex><span><span style=color:#228b22># GLBCDefaultBackend is running at https://34.45.80.180/api/v1/namespaces/kube-system/services/default-http-backend:http/proxy</span>
</span></span><span style=display:flex><span><span style=color:#228b22># KubeDNS is running at https://34.45.80.180/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Metrics-server is running at https://34.45.80.180/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;.</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=任務-2-部署-ollama>任務 2. 部署 Ollama</h2><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl apply -f ollama.yaml
</span></span><span style=display:flex><span><span style=color:#228b22># Warning: autopilot-default-resources-mutator:Autopilot updated StatefulSet default/ollama: defaulted unspecified &#39;nvidia.com/gpu&#39; resource for containers [ollama] (see http://g.co/gke/autopilot-defaults).</span>
</span></span><span style=display:flex><span><span style=color:#228b22># statefulset.apps/ollama created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># service/ollama created</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get pods -w
</span></span><span style=display:flex><span><span style=color:#228b22># 等待 ollama-0 Pod 變成 Running 狀態，表示 Ollama 已成功部署。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get nodes
</span></span><span style=display:flex><span><span style=color:#228b22># NAME                                        STATUS   ROLES    AGE     VERSION</span>
</span></span><span style=display:flex><span><span style=color:#228b22># gk3-my-cluster-nap-1l47y8kj-033ca61f-rgvm   Ready    &lt;none&gt;   2m54s   v1.30.5-gke.1014001</span>
</span></span><span style=display:flex><span><span style=color:#228b22># gk3-my-cluster-nap-nwlb0qz1-ea6bcb2c-b44d   Ready    &lt;none&gt;   2m9s    v1.30.5-gke.1014001</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=任務-3-使用-ollama-cli-與-gemma-2-互動>任務 3. 使用 Ollama CLI 與 Gemma 2 互動</h2><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#228b22># 安裝 Ollama CLI：在 Cloud Shell 中執行以下指令安裝 Ollama CLI：</span>
</span></span><span style=display:flex><span>curl -fsSL https://ollama.com/install.sh | sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 將 Ollama 服務端口轉發到本地： 執行以下指令，將 Ollama 服務的 11434 端口轉發到本地 (Cloud Shell) 的 11434 端口：</span>
</span></span><span style=display:flex><span>kubectl port-forward svc/ollama 11434:11434
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 在新分頁中執行 Gemma 2 模型： 在新的終端分頁中，設定 OLLAMA_HOST 環境變數，指定 Ollama API 的地址，然後使用 ollama run 指令執行 Gemma 2 模型：</span>
</span></span><span style=display:flex><span><span style=color:#00688b>OLLAMA_HOST</span>=http://localhost:11434 ollama run gemma2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt;&gt;&gt; 你好！
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 你好！👋  有什么我可以帮你的吗？😊</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=任務-4-部署-open-webui打造更友善的-chatbot-互動介面>任務 4. 部署 Open WebUI，打造更友善的 Chatbot 互動介面</h2><p><code>openwebui.yaml</code></p><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gke-chatbot/ class=post-read-more>[閱讀全文]</a></div></article><article class=post-preview><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gke-llm-fine-tuning/><h2 class=post-title></h2></a><p class=post-meta><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;發表於 0001-01-01
&nbsp;(最後修改於 2024-10-24)
&nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;8&nbsp;分鐘
&nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;3630&nbsp;個字
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;androchentw</span></p><div class=post-entry><h1 id=gke-llm-fine-tuning--k8s-summit-2024-gcp-workshop>GKE LLM Fine-Tuning | K8s Summit 2024 GCP Workshop</h1><h2 id=preparation>Preparation</h2><ul><li><a href=https://explore.qwiklabs.com/classrooms/16036/labs/95048>Fine-tune Open Source LLMs on GKE | CE093</a><ul><li><a href=https://github.com/GoogleCloudPlatform/ai-on-gke/tree/main/tutorials-and-examples/genAI-LLM/finetuning-llama-7b-on-l4>ai-on-gke > finetuning-llama-7b-on-l4</a></li><li><a href=https://huggingface.co/datasets/dell-research-harvard/AmericanStories>dell-research-harvard/AmericanStories dataset</a></li></ul></li><li>Learning Objectives<ul><li>Prepare your environment with a GKE cluster in standard mode.</li><li>Set up an autoscaling L4 GPU nodepool.</li><li>Run a Kubernetes Job to download Llama 2 7b and fine-tune using L4 GPUs</li><li>Make use of GCS for efficient storage of models.</li></ul></li></ul><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>student_03_216a983cfb25@cloudshell:~ (qwiklabs-asl-02-cd54d6e804de)$ 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud auth list
</span></span><span style=display:flex><span><span style=color:#228b22># Credentialed Accounts</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># ACTIVE: *</span>
</span></span><span style=display:flex><span><span style=color:#228b22># ACCOUNT: student-03-216a983cfb25@qwiklabs.net</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud config list project
</span></span><span style=display:flex><span><span style=color:#228b22># [core]</span>
</span></span><span style=display:flex><span><span style=color:#228b22># project = qwiklabs-asl-02-cd54d6e804de</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># Your active configuration is: [cloudshell-23006]</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=step-1-create-the-gke-cluster>Step 1: Create the GKE Cluster</h3><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>CLUSTER_NAME</span>=<span style=color:#cd5555>&#34;ml-gke&#34;</span>
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>REGION</span>=<span style=color:#cd5555>&#34;us-central1&#34;</span>
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>BUCKET_NAME</span>=<span style=color:#cd5555>${</span><span style=color:#00688b>GOOGLE_CLOUD_PROJECT</span><span style=color:#cd5555>}</span>-llama-l4
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>SERVICE_ACCOUNT</span>=<span style=color:#cd5555>&#34;l4-lab@</span><span style=color:#cd5555>${</span><span style=color:#00688b>GOOGLE_CLOUD_PROJECT</span><span style=color:#cd5555>}</span><span style=color:#cd5555>.iam.gserviceaccount.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud container clusters create <span style=color:#00688b>$CLUSTER_NAME</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --enable-image-streaming <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --addons=HttpLoadBalancing <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --machine-type=e2-standard-2 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --shielded-secure-boot <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --shielded-integrity-monitoring <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --region=<span style=color:#cd5555>${</span><span style=color:#00688b>REGION</span><span style=color:#cd5555>}</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --num-nodes=<span style=color:#b452cd>1</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --enable-ip-alias <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --release-channel=rapid <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --node-locations=<span style=color:#cd5555>${</span><span style=color:#00688b>REGION</span><span style=color:#cd5555>}</span>-a <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --workload-pool=<span style=color:#cd5555>${</span><span style=color:#00688b>GOOGLE_CLOUD_PROJECT</span><span style=color:#cd5555>}</span>.svc.id.goog <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --addons GcsFuseCsiDriver
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># Note: The Kubelet readonly port (10255) is now deprecated. Please update your workloads to use the recommended alternatives. See https://cloud.google.com/kubernetes-engine/docs/how-to/disable-kubelet-readonly-port for ways to check usage and for migration instructions.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Creating cluster ml-gke in us-central1... Cluster is being health-checked (Kubernetes Control Plane is healthy)...done.                           </span>
</span></span><span style=display:flex><span><span style=color:#228b22># Created [https://container.googleapis.com/v1/projects/qwiklabs-asl-02-cd54d6e804de/zones/us-central1/clusters/ml-gke].</span>
</span></span><span style=display:flex><span><span style=color:#228b22># To inspect the contents of your cluster, go to: https://console.cloud.google.com/kubernetes/workload_/gcloud/us-central1/ml-gke?project=qwiklabs-asl-02-cd54d6e804de</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=step-2-validate-cluster-readiness>Step 2: Validate Cluster Readiness</h3><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>gcloud container clusters list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME: ml-gke
</span></span><span style=display:flex><span>LOCATION: us-central1
</span></span><span style=display:flex><span>MASTER_VERSION: 1.31.1-gke.1146000
</span></span><span style=display:flex><span>MASTER_IP: 34.67.21.231
</span></span><span style=display:flex><span>MACHINE_TYPE: e2-standard-2
</span></span><span style=display:flex><span>NODE_VERSION: 1.31.1-gke.1146000
</span></span><span style=display:flex><span>NUM_NODES: <span style=color:#b452cd>1</span>
</span></span><span style=display:flex><span>STATUS: RUNNING
</span></span></code></pre></td></tr></table></div></div><h2 id=get-access-to-the-model>Get access to the model</h2><h3 id=sign-the-license-consent-agreement>Sign the license consent agreement</h3><ul><li>Request access to Meta Llama models by submitting the request access form at <a href=https://ai.meta.com/resources/models-and-libraries/llama-downloads/>https://ai.meta.com/resources/models-and-libraries/llama-downloads/</a></li><li>Accept the model terms.</li><li>Login to Hugging Faces and find the llama2-7b-chat-hf model. <a href=https://huggingface.co/meta-llama/Llama-2-7b-chat-hf>https://huggingface.co/meta-llama/Llama-2-7b-chat-hf</a></li><li>Request agree to the terms and conditions.<ul><li>LLAMA 2 COMMUNITY LICENSE AGREEMENT</li></ul></li></ul><h3 id=generate-an-access-token>Generate an access token</h3><ul><li>Click Your Profile > Settings > Access Tokens.</li><li>Select New Token.</li><li>Specify a Name of your choice and a Role of at least Read.</li><li>Select Generate a token.</li><li>Copy the generated token to your clipboard.</li></ul><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-txt data-lang=txt><span style=display:flex><span>2024-10-23-k8s-summit-gcp-1
</span></span><span style=display:flex><span>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
</span></span></code></pre></td></tr></table></div></div><h2 id=prepare-your-environment>Prepare your environment</h2><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-29>29</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#228b22># Set the default environment variables:</span>
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>HF_TOKEN</span>=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
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># Create the Node Pool</span>
</span></span><span style=display:flex><span>gcloud container node-pools create gpupool --cluster ml-gke <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --accelerator <span style=color:#00688b>type</span>=nvidia-l4,count=8,gpu-driver-version=latest <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --machine-type g2-standard-96 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --ephemeral-storage-local-ssd=<span style=color:#00688b>count</span>=<span style=color:#b452cd>8</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --enable-autoscaling --enable-image-streaming <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --num-nodes=<span style=color:#b452cd>0</span> --min-nodes=<span style=color:#b452cd>0</span> --max-nodes=<span style=color:#b452cd>3</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --shielded-secure-boot <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --shielded-integrity-monitoring <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --node-locations <span style=color:#cd5555>${</span><span style=color:#00688b>REGION</span><span style=color:#cd5555>}</span>-a,<span style=color:#cd5555>${</span><span style=color:#00688b>REGION</span><span style=color:#cd5555>}</span>-b --region <span style=color:#cd5555>${</span><span style=color:#00688b>REGION</span><span style=color:#cd5555>}</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># Note: Machines with GPUs have certain limitations which may affect your workflow. Learn more at https://cloud.google.com/kubernetes-engine/docs/how-to/gpus</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Note: Starting in GKE 1.30.1-gke.115600, if you don&#39;t specify a driver version, GKE installs the default GPU driver for your node&#39;s GKE version.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Creating node pool gpupool...done.                                                                                                                </span>
</span></span><span style=display:flex><span><span style=color:#228b22># Created [https://container.googleapis.com/v1/projects/qwiklabs-asl-02-cd54d6e804de/zones/us-central1/clusters/ml-gke/nodePools/gpupool].</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># NAME: gpupool</span>
</span></span><span style=display:flex><span><span style=color:#228b22># MACHINE_TYPE: g2-standard-96</span>
</span></span><span style=display:flex><span><span style=color:#228b22># DISK_SIZE_GB: 100</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NODE_VERSION: 1.31.1-gke.1146000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># Create a Kubernetes Secret that contains the Hugging Face token</span>
</span></span><span style=display:flex><span>kubectl create secret generic hf-secret <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --from-literal=<span style=color:#00688b>hf_api_token</span>=<span style=color:#cd5555>${</span><span style=color:#00688b>HF_TOKEN</span><span style=color:#cd5555>}</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --dry-run=client -o yaml | kubectl apply -f -
</span></span><span style=display:flex><span><span style=color:#228b22># secret/hf-secret created</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=run-a-kubernetes-job-to-finetune-llama-2-7b>Run a Kubernetes Job to Finetune Llama 2 7b</h2><p>Finetuning requires a base model and a dataset. For this post, the <code>dell-research-harvard/AmericanStories</code> dataset will be used to fine-tune the Llama 2 7b base model. GCS will be used for storing the base model. GKE with GCSFuse is used to transparently save the fine-tuned model to GCS. This provides a cost efficient way to store and serve the model and only pay for the storage used by the model.</p><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gke-llm-fine-tuning/ class=post-read-more>[閱讀全文]</a></div></article></div><ul class="pager main-pager"><li class=previous><a href=https://blog.androchen.tw/tech/page/2/>&larr; 更新的文章</a></li><li class=next><a href=https://blog.androchen.tw/tech/page/4/>更舊的文章 &rarr;</a></li></ul></div></div></div><footer class=post-footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><iframe src=https://programmur.substack.com/embed width=100% height=320 style="border:1px solid #eee;background:#fff" frameborder=0 scrolling=no></iframe><div><br></div><ul class="list-inline text-center footer-links"><li><a href=mailto:programmur.tw@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.facebook.com/ProgramMur title=Facebook><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/androchentw title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/ProgramMurTw title=Twitter><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/androchen title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.instagram.com/ProgramMur title=Instagram><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-instagram fa-stack-1x fa-inverse"></i></span></a></li><li><a href=/tech/feed.xml title=RSS><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://blog.androchen.tw/>androchentw</a>
&nbsp;&bull;&nbsp;&copy;
2024
&nbsp;&bull;&nbsp;
<a href=https://blog.androchen.tw/>ProgramMur - 程序猿碎念</a></p><p class="credits theme-by text-muted">由 <a href=https://gohugo.io>Hugo v0.136.4</a> 提供 &nbsp;&bull;&nbsp; 主題 <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> 移植自 <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
&nbsp;&bull;&nbsp;[<a href=5ea6d7da53353ace17ba5e27deefae0362260751>5ea6d7da</a>]</p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=https://blog.androchen.tw/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://blog.androchen.tw/js/load-photoswipe.js></script><script>(function(){var t,n="212df771d70ae0521",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>$(function(){$("#show-comments").on("click",function(){var e="androchenblog";(function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)})(),$(this).hide()})})</script><script id=dsq-count-scr src=//androchenblog.disqus.com/count.js async></script><div class=back-to-top id=back-to-top><i class="fas fa-angle-double-up"></i></div></body></html>