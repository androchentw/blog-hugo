<!doctype html><html lang=zh-tw itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>ProgramMur - 程序猿碎念 - </title><meta name=description content="GCP OTel | K8s Summit 2024 GCP Workshop
Ref

OpenTelemetry 可觀測性的未來

Preparation

Application Monitoring with OpenTelemetry

OpenTelemetry是CNCF推廣的容器平台監控技術，針對SRE常用的Metrics, Log, 以及Trace提供了完整的支援。其廣大生態圈，不但可在無侵入的狀態下，廣泛支持各種的程式語言(e.g. Python, Java, .NET, JS等），也提供讓SRE可彈性客制監控標的。"><meta name=author content="androchentw"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"ProgramMur - 程序猿碎念","url":"https:\/\/blog.androchen.tw\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/blog.androchen.tw\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/blog.androchen.tw\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/blog.androchen.tw\/tech\/tech-event\/2024-k8s-summit-workshop\/gcp-otel\/","name":""}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"androchentw"},"headline":"","description":"GCP OTel | K8s Summit 2024 GCP Workshop Ref\nOpenTelemetry 可觀測性的未來 Preparation Application Monitoring with OpenTelemetry OpenTelemetry是CNCF推廣的容器平台監控技術，針對SRE常用的Metrics, Log, 以及Trace提供了完整的支援。其廣大生態圈，不但可在無侵入的狀態下，廣泛支持各種的程式語言(e.g. Python, Java, .NET, JS等），也提供讓SRE可彈性客制監控標的。\n","inLanguage":"zh-tw","wordCount":8234,"datePublished":"0001-01-01T00:00:00\u002b00:00","dateModified":"2024-10-24T17:39:59\u002b08:00","image":"https:\/\/github.com\/androchentw\/blog-hugo\/blob\/main\/res\/blog-cover-yume-square.jpg?raw=true","keywords":[""],"mainEntityOfPage":"https:\/\/blog.androchen.tw\/tech\/tech-event\/2024-k8s-summit-workshop\/gcp-otel\/","publisher":{"@type":"Organization","name":"https:\/\/blog.androchen.tw\/","logo":{"@type":"ImageObject","url":"https:\/\/github.com\/androchentw\/blog-hugo\/blob\/main\/res\/blog-cover-yume-square.jpg?raw=true","height":60,"width":60}}}</script><meta property="og:title" content=" | ProgramMur - 程序猿碎念"><meta property="og:description" content="GCP OTel | K8s Summit 2024 GCP Workshop
Ref

OpenTelemetry 可觀測性的未來

Preparation

Application Monitoring with OpenTelemetry

OpenTelemetry是CNCF推廣的容器平台監控技術，針對SRE常用的Metrics, Log, 以及Trace提供了完整的支援。其廣大生態圈，不但可在無侵入的狀態下，廣泛支持各種的程式語言(e.g. Python, Java, .NET, JS等），也提供讓SRE可彈性客制監控標的。"><meta property="og:image" content="https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume.jpg?raw=true"><meta property="og:url" content="https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-otel/"><meta property="og:type" content="website"><meta property="og:site_name" content="ProgramMur - 程序猿碎念"><meta name=twitter:title content="ProgramMur - 程序猿碎念"><meta name=twitter:description content="GCP OTel | K8s Summit 2024 GCP Workshop
Ref

OpenTelemetry 可觀測性的未來

Preparation

Application Monitoring with OpenTelemetry

OpenTelemetry是CNCF推廣的容器平台監控技術，針對SRE常用的Metrics, Log, 以及Trace提供了完整的支援。其廣大生態圈，不 …"><meta name=twitter:image content="https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume-square.jpg?raw=true"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@ProgramMurTw"><meta name=twitter:creator content="@ProgramMurTw"><link href='https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume-square.jpg?raw=true' rel=icon type=image/x-icon><meta name=generator content="Hugo 0.136.4"><link rel=alternate href=https://blog.androchen.tw/index.xml type=application/rss+xml title="ProgramMur - 程序猿碎念"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css integrity=sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css integrity=sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu crossorigin=anonymous><link rel=stylesheet href=https://blog.androchen.tw/css/main-nodark.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://blog.androchen.tw/css/syntax.css><link rel=stylesheet href=https://blog.androchen.tw/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=G-PN5YM4PWN6"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PN5YM4PWN6")}</script></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>開關導覽</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://blog.androchen.tw/>ProgramMur - 程序猿碎念</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Life href=/life/>Life</a></li><li><a title=Soft href=/soft/>Soft</a></li><li><a title=Tech href=/tech/>Tech</a></li><li><a title=Series href=/series/>Series</a></li><li><a title=Tags href=/tags/>Tags</a></li><li><a title=Archives href=/archives/>Archives</a></li><li class=navlinks-container><a class=navlinks-parent role=button tabindex=0>🌐 語言</a><div class=navlinks-children></div></li><li><a href=#modalSearch data-toggle=modal data-target=#modalSearch style=outline:none><span class="hidden-sm hidden-md hidden-lg">搜尋</span> <span id=searchGlyph class="glyphicon glyphicon-search"></span></a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="ProgramMur - 程序猿碎念" href=https://blog.androchen.tw/><img class=avatar-img src="https://github.com/androchentw/blog-hugo/blob/main/res/blog-cover-yume-square.jpg?raw=true" alt="ProgramMur - 程序猿碎念"></a></div></div></div></nav><div id=modalSearch class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close data-dismiss=modal>&#215;</button><h4 class=modal-title>搜尋 ProgramMur - 程序猿碎念</h4></div><div class=modal-body><gcse:search></gcse:search></div><div class=modal-footer><button type=button class="btn btn-default" data-dismiss=modal>關閉</button></div></div></div></div><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><div class=intro-header></div><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><aside class=toc-article><nav id=TableOfContents><ul><li><a href=#gcp-otel--k8s-summit-2024-gcp-workshop>GCP OTel | K8s Summit 2024 GCP Workshop</a><ul><li><a href=#preparation>Preparation</a><ul><li><a href=#what-will-you-learn>What will you learn?</a></li><li><a href=#setup-and-requirements>Setup and Requirements</a></li><li><a href=#設定-console-專案>設定 Console 專案</a></li><li><a href=#確認gke叢集>確認GKE叢集</a></li></ul></li><li><a href=#auto-instrumentation-with-opentelemetry-operator>Auto-Instrumentation with OpenTelemetry Operator</a><ul><li><a href=#安裝opentelemetry-operator與collector>安裝OpenTelemetry Operator與Collector</a></li><li><a href=#部署cert-manager-cert-manager為了otel-operator提供憑證>部署Cert Manager: Cert-Manager為了OTEL Operator提供憑證</a></li><li><a href=#部署opentelemetry-operator>部署Opentelemetry Operator</a></li><li><a href=#部署-opentelemetry-collector>部署 OpenTelemetry Collector</a></li></ul></li><li><a href=#部署-instrumentation-物件>部署 Instrumentation 物件</a></li><li><a href=#部署測試用服務>部署測試用服務</a></li><li><a href=#guestbook-backpy-的程式碼修改>GuestBook back.py 的程式碼修改</a></li><li><a href=#guestbook-開發部署的設定碼修改>GuestBook 開發+部署的設定碼修改</a></li><li><a href=#skaffold-打包容器並部署服務>Skaffold 打包容器並部署服務</a></li><li><a href=#製造-traffic>製造 Traffic</a></li><li><a href=#壓測-optional>壓測 (Optional)</a><ul><li><a href=#下載分散式測試的git專案>下載分散式測試的Git專案</a></li><li><a href=#修改taskpy>修改task.py</a></li><li><a href=#修改kubernetes-config下的模板>修改kubernetes-config下的模板</a></li><li><a href=#產生部署檔案並通過skaffold部署>產生部署檔案，並通過skaffold部署</a></li><li><a href=#檢視locust的壓測ui>檢視Locust的壓測UI</a></li></ul></li><li><a href=#檢視監控結果>檢視監控結果</a><ul><li><a href=#2024-10-24-issue>2024-10-24 Issue</a></li></ul></li><li><a href=#結束lab>結束Lab</a></li></ul></li></ul></nav></aside><article role=main class=blog-post><h1 id=gcp-otel--k8s-summit-2024-gcp-workshop>GCP OTel | K8s Summit 2024 GCP Workshop</h1><p>Ref</p><ul><li><a href=https://github.com/marcustung/obervability-opentelemetry/blob/main/OpenTelemetry%20%E5%8F%AF%E8%A7%80%E6%B8%AC%E6%80%A7%E7%9A%84%E6%9C%AA%E4%BE%86.md>OpenTelemetry 可觀測性的未來</a></li></ul><h2 id=preparation>Preparation</h2><ul><li><a href=https://explore.qwiklabs.com/classrooms/16111/labs/95466>Application Monitoring with OpenTelemetry</a></li></ul><p>OpenTelemetry是CNCF推廣的<a href=https://github.com/open-telemetry/opentelemetry-collector-contrib>容器平台監控技術</a>，針對SRE常用的Metrics, Log, 以及Trace提供了完整的支援。其廣大生態圈，不但可在無侵入的狀態下，廣泛支持各種的程式語言(e.g. Python, Java, .NET, JS等），也提供讓SRE可彈性客制監控標的。</p><p>雖然OpenTelemetry社群推出了OpenTelemetry Operator，希望簡化整個的Collector安裝流程。在第一個Lab，我們會學習如何通過OpenTelemetry Operator部署<a href=https://www.cncf.io/blog/2021/08/26/opentelemetry-becomes-a-cncf-incubating-project/>完整支援第三方Exporter/Receiver的完整Collector</a>，而非僅有核心模組的Collector，並加上Auto-Instrumentation部署，這樣的部署能在不額外添加任何程式碼下，通過OpenTelemetry直接收集呼叫軌跡(Trace)。Metrics的部分，Lab1會教大家如果通過引入基於語言Prometheus函式庫，快速產生服務使用到API的效能統計資訊。</p><img style=width:80% src=https://cdn.qwiklabs.com/97gl2aYFHR7jVj1d7qHLw9oW5%2FaUugd7rd98Q9St%2BkI%3D><p align=center><sub><sup>OTel 架構</sup></sub></p><h3 id=what-will-you-learn>What will you learn?</h3><p>這個 Workshop 希望讓大家了解 OpenTelemetry Collector Core Library 的能力：</p><ol><li>如何通過OpenTelemetry Operator搭建OpenTelemetry Collector</li><li>設定Telemetry ＋ Metrics 的Collector Pipeline</li><li>在不增加任何程式碼下，通過OpenTelemetry Auto-Instrumentation得到服務的呼叫軌跡</li><li>通過Google Managed Prometheus以及Cloud Trace來展示結果</li></ol><h3 id=setup-and-requirements>Setup and Requirements</h3><ul><li>Activate Cloud Shell</li><li>開發程式碼產生：按下 <code>Command + Shift + P</code> 組合鍵，在搜尋列中打上 <code>New Application</code>，選擇 <code>Kubernetes Application</code> ，再由中間挑選想開發的語言: 『<code>Python (Flask): GuestBook</code>』，由Cloud Code生成模板。今天我們選擇Python Flask，我們使用預設的專案名稱『guestbook-1』，按下 <code>Create New Applications</code></li></ul><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>Command + Shift + P
</span></span><span style=display:flex><span>Cloud Code: New Application 
</span></span><span style=display:flex><span>&gt; Kubernetes Application 
</span></span><span style=display:flex><span>&gt; Python (Flask): GuestBook
</span></span><span style=display:flex><span>&gt; guestbook-1
</span></span><span style=display:flex><span>&gt; Create New Applications
</span></span></code></pre></td></tr></table></div></div><h3 id=設定-console-專案>設定 Console 專案</h3><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>PROJECT_ID</span>=<span style=color:#cd5555>&#34;qwiklabs-gcp-01-0cda8821429a&#34;</span> 
</span></span><span style=display:flex><span>gcloud config <span style=color:#658b00>set</span> project <span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span> 
</span></span><span style=display:flex><span>gcloud config <span style=color:#658b00>set</span> compute/region asia-east1
</span></span><span style=display:flex><span>gcloud config <span style=color:#658b00>set</span> compute/zone asia-east1-c
</span></span></code></pre></td></tr></table></div></div><h3 id=確認gke叢集>確認GKE叢集</h3><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-21>21</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#228b22># Lab創建時已經通過Terraform，預將GKE叢集建立完畢，請依照下方指令取得GKE控制檔案：</span>
</span></span><span style=display:flex><span>gcloud container clusters list
</span></span><span style=display:flex><span><span style=color:#228b22># NAME: lab-cluster</span>
</span></span><span style=display:flex><span><span style=color:#228b22># LOCATION: asia-east1-a</span>
</span></span><span style=display:flex><span><span style=color:#228b22># MASTER_VERSION: 1.30.5-gke.1014001</span>
</span></span><span style=display:flex><span><span style=color:#228b22># MASTER_IP: 34.80.48.118</span>
</span></span><span style=display:flex><span><span style=color:#228b22># MACHINE_TYPE: e2-standard-4</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NODE_VERSION: 1.30.5-gke.1014001</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NUM_NODES: 3</span>
</span></span><span style=display:flex><span><span style=color:#228b22># STATUS: RUNNING</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 取得GKE控制用檔案(kubeconfig)</span>
</span></span><span style=display:flex><span>gcloud container clusters get-credentials lab-cluster --zone asia-east1-a
</span></span><span style=display:flex><span><span style=color:#228b22># Fetching cluster endpoint and auth data.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># kubeconfig entry generated for lab-cluster.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get node
</span></span><span style=display:flex><span><span style=color:#228b22># NAME                                              STATUS   ROLES    AGE   VERSION</span>
</span></span><span style=display:flex><span><span style=color:#228b22># gke-lab-cluster-default-node-pool-31204075-7rct   Ready    &lt;none&gt;   13m   v1.30.5-gke.1014001</span>
</span></span><span style=display:flex><span><span style=color:#228b22># gke-lab-cluster-default-node-pool-31204075-ck5t   Ready    &lt;none&gt;   13m   v1.30.5-gke.1014001</span>
</span></span><span style=display:flex><span><span style=color:#228b22># gke-lab-cluster-default-node-pool-31204075-d8h3   Ready    &lt;none&gt;   13m   v1.30.5-gke.1014001</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=auto-instrumentation-with-opentelemetry-operator>Auto-Instrumentation with OpenTelemetry Operator</h2><h3 id=安裝opentelemetry-operator與collector>安裝OpenTelemetry Operator與Collector</h3><p>OpenTelemetry(a.k.a otel) 的 K8S 安裝，主要由 OpenTelemetry Operator (aka otel operator) 與 Collector(aka otel collector) 兩個部分組成，其中 otel Operator 的部署，主要是為了生成(保護）otel Collector，同時，對於想要監控的服務，提供自動的 sidecar注入控制，讓開發者在不需要手動進行任何的代碼改動，就可以看到想追蹤的軌跡。</p><p>以下我們在GKE安裝Opentelemetry, 主要分為三塊安裝：Cert-Manger, Operator & Collector。</p><h3 id=部署cert-manager-cert-manager為了otel-operator提供憑證>部署Cert Manager: Cert-Manager為了OTEL Operator提供憑證</h3><p>在OTEL的運作過程中，當希望不修改現有程式，直接提供呼叫軌跡時，OTEL通過Mutation Webhook的呼叫，完成sidecar的注入。Mutation webhook的生成就需要通過<a href=https://trstringer.com/admission-control-cert-manager/>cert-manager提供API server</a>可以相信的憑證資訊。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-37>37</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>helm repo add jetstack https://charts.jetstack.io
</span></span><span style=display:flex><span>helm repo update
</span></span><span style=display:flex><span>helm install <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --create-namespace <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --namespace cert-manager <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --set <span style=color:#00688b>installCRDs</span>=<span style=color:#658b00>true</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --set global.leaderElection.namespace=cert-manager <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --set <span style=color:#00688b>extraArgs</span>={--issuer-ambient-credentials=true} <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  cert-manager jetstack/cert-manager
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># &#34;jetstack&#34; has been added to your repositories</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Hang tight while we grab the latest from your chart repositories...</span>
</span></span><span style=display:flex><span><span style=color:#228b22># ...Successfully got an update from the &#34;jetstack&#34; chart repository</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Update Complete. ⎈Happy Helming!⎈</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NAME: cert-manager</span>
</span></span><span style=display:flex><span><span style=color:#228b22># LAST DEPLOYED: Thu Oct 24 00:45:45 2024</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NAMESPACE: cert-manager</span>
</span></span><span style=display:flex><span><span style=color:#228b22># STATUS: deployed</span>
</span></span><span style=display:flex><span><span style=color:#228b22># REVISION: 1</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TEST SUITE: None</span>
</span></span><span style=display:flex><span><span style=color:#228b22># NOTES:</span>
</span></span><span style=display:flex><span><span style=color:#228b22># ⚠️  WARNING: `installCRDs` is deprecated, use `crds.enabled` instead.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># cert-manager v1.16.1 has been deployed successfully!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># In order to begin issuing certificates, you will need to set up a ClusterIssuer</span>
</span></span><span style=display:flex><span><span style=color:#228b22># or Issuer resource (for example, by creating a &#39;letsencrypt-staging&#39; issuer).</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># More information on the different types of issuers and how to configure them</span>
</span></span><span style=display:flex><span><span style=color:#228b22># can be found in our documentation:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># https://cert-manager.io/docs/configuration/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># For information on how to configure cert-manager to automatically provision</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Certificates for Ingress resources, take a look at the `ingress-shim`</span>
</span></span><span style=display:flex><span><span style=color:#228b22># documentation:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># https://cert-manager.io/docs/usage/ingress/</span>
</span></span></code></pre></td></tr></table></div></div><p>Note: 此次使用的GKE叢集為Public Cluster，若未來若使用Private Cluster，受限於Master節點訪問mutation webhook需要通過內部VPC網路，需開放 <code>9443</code> 防火牆。</p><h3 id=部署opentelemetry-operator>部署Opentelemetry Operator</h3><img style=width:80% src=https://cdn.qwiklabs.com/JOZGAFxce0aKvQidRC6aNF2CN%2Baiks1E9b8TBkehOYw%3D><p align=center><sub><sup>OTel Operator</sup></sub></p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-31>31</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#228b22># 這個元件具有兩個主要功能，Opentelemetry Collector的CRD生成與保護，以及Instrumentation的auto-injection。部署命令如下：</span>
</span></span><span style=display:flex><span>kubectl apply -f https://github.com/open-telemetry/opentelemetry-operator/releases/latest/download/opentelemetry-operator.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># namespace/opentelemetry-operator-system created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># customresourcedefinition.apiextensions.k8s.io/instrumentations.opentelemetry.io created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># customresourcedefinition.apiextensions.k8s.io/opampbridges.opentelemetry.io created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># customresourcedefinition.apiextensions.k8s.io/opentelemetrycollectors.opentelemetry.io created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># serviceaccount/opentelemetry-operator-controller-manager created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># role.rbac.authorization.k8s.io/opentelemetry-operator-leader-election-role created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># clusterrole.rbac.authorization.k8s.io/opentelemetry-operator-manager-role created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># clusterrole.rbac.authorization.k8s.io/opentelemetry-operator-metrics-reader created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># clusterrole.rbac.authorization.k8s.io/opentelemetry-operator-proxy-role created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># rolebinding.rbac.authorization.k8s.io/opentelemetry-operator-leader-election-rolebinding created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># clusterrolebinding.rbac.authorization.k8s.io/opentelemetry-operator-manager-rolebinding created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># clusterrolebinding.rbac.authorization.k8s.io/opentelemetry-operator-proxy-rolebinding created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># service/opentelemetry-operator-controller-manager-metrics-service created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># service/opentelemetry-operator-webhook-service created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># deployment.apps/opentelemetry-operator-controller-manager created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># certificate.cert-manager.io/opentelemetry-operator-serving-cert created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># issuer.cert-manager.io/opentelemetry-operator-selfsigned-issuer created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># mutatingwebhookconfiguration.admissionregistration.k8s.io/opentelemetry-operator-mutating-webhook-configuration created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># validatingwebhookconfiguration.admissionregistration.k8s.io/opentelemetry-operator-validating-webhook-configuration created</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 部署成功的訊息裡，我們可以快速瀏覽，找尋到以下的訊息，即可得知cert-manager所扮演的角色。</span>
</span></span><span style=display:flex><span>certificate.cert-manager.io/opentelemetry-operator-serving-cert created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>issuer.cert-manager.io/opentelemetry-operator-selfsigned-issuer created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mutatingwebhookconfiguration.admissionregistration.k8s.io/opentelemetry-operator-mutating-webhook-configuration created
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>validatingwebhookconfiguration.admissionregistration.k8s.io/opentelemetry-operator-validating-webhook-configuration created
</span></span></code></pre></td></tr></table></div></div><h3 id=部署-opentelemetry-collector>部署 OpenTelemetry Collector</h3><p>接下來，我們部署OpenTelemetry Collector用以收集服務產生出的監控資訊。OpenTelemetry Controller是一個特別的CRD物件，會由OpenTelemetry Operator收到後，部署出對應的Collector pod在指定的名稱空間中。</p><p>底下我們先創建名稱空間: otel-collector，作為Collector的instance使用，為了使用Workload Identity讓這個Collector pod有足夠的權限寫入GoogleManagedPrometheus, CloudTrace, 跟Cloud Logging，我們必須先製作一個serviceAccount: otel-collector-demo，同時因為我們會使用到prometheus scrape的能力，這個serviceAccount還要加上能夠列出pod,service的RBAC。如下所示：</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-37>37</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>K8S_SA</span>=<span style=color:#cd5555>&#34;otel-collector-demo&#34;</span>
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>K8S_NS</span>=<span style=color:#cd5555>&#34;otel-collector&#34;</span>
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>GSA</span>=<span style=color:#cd5555>&#34;otel-collector&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl create ns <span style=color:#cd5555>${</span><span style=color:#00688b>K8S_NS</span><span style=color:#cd5555>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat <span style=color:#cd5555>&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span style=display:flex><span><span style=color:#cd5555>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#cd5555>kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#cd5555>metadata:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  name: ${K8S_SA}
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  namespace: ${K8S_NS}
</span></span></span><span style=display:flex><span><span style=color:#cd5555>---
</span></span></span><span style=display:flex><span><span style=color:#cd5555>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#cd5555>kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#cd5555>metadata:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  name: otel-collector-demo
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  namespace: ${K8S_NS}
</span></span></span><span style=display:flex><span><span style=color:#cd5555>rules:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  - apiGroups: [&#39;&#39;]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>    resources: [&#39;nodes/stats&#39;, &#39;pods&#39;, &#39;services&#39;]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>    verbs: [&#39;get&#39;, &#39;watch&#39;, &#39;list&#39;]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>---
</span></span></span><span style=display:flex><span><span style=color:#cd5555>apiVersion: rbac.authorization.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#cd5555>kind: ClusterRoleBinding
</span></span></span><span style=display:flex><span><span style=color:#cd5555>metadata:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  name: otel-collector-demo
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  namespace: ${K8S_NS}
</span></span></span><span style=display:flex><span><span style=color:#cd5555>roleRef:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  apiGroup: rbac.authorization.k8s.io
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  kind: ClusterRole
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  name: otel-collector-demo
</span></span></span><span style=display:flex><span><span style=color:#cd5555>subjects:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>  - kind: ServiceAccount
</span></span></span><span style=display:flex><span><span style=color:#cd5555>    name: ${K8S_SA}
</span></span></span><span style=display:flex><span><span style=color:#cd5555>    namespace: ${K8S_NS}
</span></span></span><span style=display:flex><span><span style=color:#cd5555>EOF</span>
</span></span></code></pre></td></tr></table></div></div><p>response:</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#228b22># namespace/otel-collector created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># serviceaccount/otel-collector-demo created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># clusterrole.rbac.authorization.k8s.io/otel-collector-demo created</span>
</span></span><span style=display:flex><span><span style=color:#228b22># clusterrolebinding.rbac.authorization.k8s.io/otel-collector-demo created</span>
</span></span></code></pre></td></tr></table></div></div><p>由於我們等等希望將資料送到Cloud Trace, Google Managed Prometheus,跟Cloud Logging，需要設定otel-collector pod對於這三個服務的權限。我們通過workload identity設定如下</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-29>29</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#228b22># 確認專案 PROJECT_ID變數</span>
</span></span><span style=display:flex><span>gcloud config <span style=color:#658b00>set</span> project <span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 設定Google Service Account: otel-collector</span>
</span></span><span style=display:flex><span>gcloud iam service-accounts create <span style=color:#cd5555>${</span><span style=color:#00688b>GSA</span><span style=color:#cd5555>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 綁定Cloud Trace, GMP, 以及Cloud Logging的寫入權限。</span>
</span></span><span style=display:flex><span>gcloud projects add-iam-policy-binding <span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span><span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --member=serviceAccount:<span style=color:#cd5555>${</span><span style=color:#00688b>GSA</span><span style=color:#cd5555>}</span>@<span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span>.iam.gserviceaccount.com <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --role=roles/monitoring.metricWriter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud projects add-iam-policy-binding <span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span><span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --member=serviceAccount:<span style=color:#cd5555>${</span><span style=color:#00688b>GSA</span><span style=color:#cd5555>}</span>@<span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span>.iam.gserviceaccount.com <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --role=roles/cloudtrace.agent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud projects add-iam-policy-binding <span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span><span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --member=serviceAccount:<span style=color:#cd5555>${</span><span style=color:#00688b>GSA</span><span style=color:#cd5555>}</span>@<span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span>.iam.gserviceaccount.com <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --role=roles/logging.logWriter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 設定Workload Identity</span>
</span></span><span style=display:flex><span>gcloud iam service-accounts add-iam-policy-binding <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --role roles/iam.workloadIdentityUser <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --member <span style=color:#cd5555>&#34;serviceAccount:</span><span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span><span style=color:#cd5555>.svc.id.goog[</span><span style=color:#cd5555>${</span><span style=color:#00688b>K8S_NS</span><span style=color:#cd5555>}</span><span style=color:#cd5555>/</span><span style=color:#cd5555>${</span><span style=color:#00688b>K8S_SA</span><span style=color:#cd5555>}</span><span style=color:#cd5555>]&#34;</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  <span style=color:#cd5555>${</span><span style=color:#00688b>GSA</span><span style=color:#cd5555>}</span>@<span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span>.iam.gserviceaccount.com <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>
</span></span><span style=display:flex><span>kubectl annotate serviceaccount <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  --namespace <span style=color:#cd5555>${</span><span style=color:#00688b>K8S_NS</span><span style=color:#cd5555>}</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  <span style=color:#cd5555>${</span><span style=color:#00688b>K8S_SA</span><span style=color:#cd5555>}</span> <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>  iam.gke.io/gcp-service-account=<span style=color:#cd5555>${</span><span style=color:#00688b>GSA</span><span style=color:#cd5555>}</span>@<span style=color:#cd5555>${</span><span style=color:#00688b>PROJECT_ID</span><span style=color:#cd5555>}</span>.iam.gserviceaccount.com
</span></span></code></pre></td></tr></table></div></div><p>response:</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1>  1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-2>  2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-3>  3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-4>  4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-5>  5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-6>  6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-7>  7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-8>  8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-9>  9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-10> 10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-11> 11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-12> 12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-13> 13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-14> 14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-15> 15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-16> 16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-17> 17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-18> 18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-19> 19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-20> 20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-21> 21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-22> 22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-23> 23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-24> 24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-25> 25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-26> 26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-27> 27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-28> 28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-29> 29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-30> 30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-31> 31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-32> 32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-33> 33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-34> 34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-35> 35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-36> 36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-37> 37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-38> 38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-39> 39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-40> 40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-41> 41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-42> 42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-43> 43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-44> 44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-45> 45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-46> 46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-47> 47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-48> 48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-49> 49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-50> 50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-51> 51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-52> 52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-53> 53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-54> 54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-55> 55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-56> 56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-57> 57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-58> 58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-59> 59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-60> 60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-61> 61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-62> 62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-63> 63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-64> 64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-65> 65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-66> 66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-67> 67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-68> 68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-69> 69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-70> 70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-71> 71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-72> 72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-73> 73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-74> 74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-75> 75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-76> 76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-77> 77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-78> 78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-79> 79</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-80> 80</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-81> 81</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-82> 82</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-83> 83</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-84> 84</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-85> 85</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-86><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-86> 86</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-87><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-87> 87</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-88><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-88> 88</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-89><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-89> 89</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-90><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-90> 90</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-91><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-91> 91</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-92><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-92> 92</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-93><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-93> 93</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-94><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-94> 94</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-95><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-95> 95</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-96><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-96> 96</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-97><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-97> 97</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-98><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-98> 98</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-99><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-99> 99</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-100><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-100>100</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-101><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-101>101</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-102><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-102>102</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-103><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-103>103</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-104><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-104>104</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-105><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-105>105</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-106><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-106>106</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-107><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-107>107</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-108><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-108>108</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-109><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-109>109</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-110><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-110>110</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-111><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-111>111</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-112><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-112>112</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-113><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-113>113</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-114><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-114>114</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-115><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-115>115</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-116><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-116>116</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-117><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-117>117</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-118><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-118>118</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-119><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-119>119</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-120><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-120>120</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-121><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-121>121</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-122><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-122>122</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-123><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-123>123</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-124><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-124>124</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-125><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-125>125</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-126><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-126>126</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-127><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-127>127</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-128><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-128>128</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-129><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-129>129</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-130><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-130>130</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-131><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-131>131</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-132><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-132>132</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-133><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-133>133</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-134><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-134>134</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-135><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-135>135</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-136><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-136>136</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-137><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-137>137</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-138><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-138>138</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-139><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-139>139</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span>Updated property [core/project].<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Created service account [otel-collector].<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Updated IAM policy for project [qwiklabs-gcp-01-0cda8821429a].<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>bindings</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/bigquery.admin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090@cloudbuild.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudbuild.builds.builder<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@gcp-sa-cloudbuild.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudbuild.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@compute-system.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/compute.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@container-engine-robot.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/container.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090-compute@developer.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090@cloudservices.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/editor<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:otel-collector@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/monitoring.metricWriter<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:admiral@qwiklabs-services-prod.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- user:student-03-c40dfb54bf6e@qwiklabs.net<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/owner<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@serverless-robot-prod.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/run.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/storage.admin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- user:student-03-c40dfb54bf6e@qwiklabs.net<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/viewer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>etag</span>:<span style=color:#bbb> </span>BwYlLlgifis=<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#b452cd>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Updated IAM policy for project [qwiklabs-gcp-01-0cda8821429a].<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>bindings</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/bigquery.admin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090@cloudbuild.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudbuild.builds.builder<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@gcp-sa-cloudbuild.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudbuild.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:otel-collector@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudtrace.agent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@compute-system.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/compute.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@container-engine-robot.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/container.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090-compute@developer.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090@cloudservices.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/editor<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:otel-collector@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/monitoring.metricWriter<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:admiral@qwiklabs-services-prod.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- user:student-03-c40dfb54bf6e@qwiklabs.net<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/owner<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@serverless-robot-prod.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/run.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/storage.admin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- user:student-03-c40dfb54bf6e@qwiklabs.net<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/viewer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>etag</span>:<span style=color:#bbb> </span>BwYlLlhY3L0=<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#b452cd>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Updated IAM policy for project [qwiklabs-gcp-01-0cda8821429a].<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>bindings</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/bigquery.admin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090@cloudbuild.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudbuild.builds.builder<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@gcp-sa-cloudbuild.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudbuild.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:otel-collector@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/cloudtrace.agent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@compute-system.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/compute.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@container-engine-robot.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/container.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090-compute@developer.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:250649173090@cloudservices.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/editor<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:otel-collector@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/logging.logWriter<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:otel-collector@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/monitoring.metricWriter<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:admiral@qwiklabs-services-prod.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- user:student-03-c40dfb54bf6e@qwiklabs.net<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/owner<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:service-250649173090@serverless-robot-prod.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/run.serviceAgent<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/storage.admin<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- user:student-03-c40dfb54bf6e@qwiklabs.net<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/viewer<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>etag</span>:<span style=color:#bbb> </span>BwYlLliOQ4A=<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#b452cd>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Updated IAM policy for serviceAccount [otel-collector@qwiklabs-gcp-01-0cda8821429a.iam.gserviceaccount.com].<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>bindings</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#8b008b;font-weight:700>members</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- serviceAccount:qwiklabs-gcp-01-0cda8821429a.svc.id.goog[otel-collector/otel-collector-demo]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>role</span>:<span style=color:#bbb> </span>roles/iam.workloadIdentityUser<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>etag</span>:<span style=color:#bbb> </span>BwYlLljFTgM=<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>version</span>:<span style=color:#bbb> </span><span style=color:#b452cd>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>serviceaccount/otel-collector-demo annotated<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><img style=width:80% src=https://cdn.qwiklabs.com/Vuy9Gse8A08Sils90J%2BJHCYuUdarczVZ1pzvepPt%2B5I%3D><p align=center><sub><sup>OTel Instrumentation</sup></sub></p><p>Collector的設定，主要分為serviceAccount 、image以及config三個欄位：</p><ol><li>serviceAccount：是為了使用workload identity，因此不能用controller自行產生的serviceAccount而需要額外設定。</li><li>image欄位：是為了讓我們可以使用到第三方的Receiver + Exporter (e.g. googlecloud, googlemanagedprometheus)。</li><li>剩下的Collector config設定：設定元素分為Receiver, Processor, 跟Exporter三層，可使用其組成多條的Pipeline，作為為Metric, Log,跟Trace的傳遞之用。下方config為例，該Controller會組成Metric, Trace兩條Pipeline，每條pipeline均以Opentelemetry receiver接入，以log的方式輸出於屏幕。</li></ol><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-63>63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-64>64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-65>65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-66>66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-67>67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-68>68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-69>69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-70>70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-71>71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-72>72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-73>73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-74>74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-75>75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-76>76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-77>77</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span>cat &lt;&lt; EOF | kubectl apply -f -<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>opentelemetry.io/v1alpha1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>OpenTelemetryCollector<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>otel<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>namespace</span>:<span style=color:#bbb> </span>${K8S_NS}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>labels</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>   </span><span style=color:#8b008b;font-weight:700>app</span>:<span style=color:#bbb> </span>otel-collector<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>serviceAccount</span>:<span style=color:#bbb> </span>${K8S_SA}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>image</span>:<span style=color:#bbb> </span>otel/opentelemetry-collector-contrib:latest<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#8b008b;font-weight:700>config</span>:<span style=color:#bbb> </span>|<span style=color:#cd5555>
</span></span></span><span style=display:flex><span><span style=color:#cd5555>   receivers:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     otlp:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       protocols:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         grpc:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         http:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     prometheus:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       config:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         scrape_configs:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         - job_name: &#39;k8s_pods&#39;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           scrape_interval: 30s
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           kubernetes_sd_configs:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           - role: pod
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           relabel_configs:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             action: &#34;keep&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             regex: &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           - source_labels: [__meta_kubernetes_pod_label_k8s_app]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             action: &#34;drop&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             regex: &#34;cilium&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           - source_labels: [__meta_kubernetes_pod_label_istio_io_rev]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             action: &#34;drop&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             regex: &#34;asm-managed&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             action: replace
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             target_label: __metrics_path__
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             regex: (.+)
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             action: replace
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             regex: ([^:]+)(?::\d+)?;(\d+)
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             replacement: \$\$1:\$\$2
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             target_label: __address__
</span></span></span><span style=display:flex><span><span style=color:#cd5555>           - action: labelmap
</span></span></span><span style=display:flex><span><span style=color:#cd5555>             regex: __meta_kubernetes_pod_label_(.+)
</span></span></span><span style=display:flex><span><span style=color:#cd5555>   processors:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     batch:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       send_batch_max_size: 100
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       send_batch_size: 100
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       timeout: 5s
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     resourcedetection:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       detectors: [gcp]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       timeout: 10s
</span></span></span><span style=display:flex><span><span style=color:#cd5555>
</span></span></span><span style=display:flex><span><span style=color:#cd5555>   exporters:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     debug:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       verbosity: detailed
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     googlemanagedprometheus:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       project: ${PROJECT_ID}
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     googlecloud:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>
</span></span></span><span style=display:flex><span><span style=color:#cd5555>   service:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     telemetry:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       logs:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         level: &#34;debug&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       metrics:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         address: &#34;:8888&#34;
</span></span></span><span style=display:flex><span><span style=color:#cd5555>     pipelines:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       traces:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         receivers: [otlp]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         processors: [batch]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         exporters: [debug, googlecloud]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>       metrics:
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         receivers: [prometheus]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         processors: [batch, resourcedetection]
</span></span></span><span style=display:flex><span><span style=color:#cd5555>         exporters: [googlemanagedprometheus]</span><span style=color:#bbb>   
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>EOF<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>validation</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl -n otel-collector get pod
</span></span><span style=display:flex><span><span style=color:#228b22># NAME                             READY   STATUS    RESTARTS   AGE</span>
</span></span><span style=display:flex><span><span style=color:#228b22># otel-collector-bbf668879-d57h6   1/1     Running   0          8m12s</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=部署-instrumentation-物件>部署 Instrumentation 物件</h2><p>最後部署Instrumentation的物件，本物件同樣由OpenTelemetry-Operator進行管理，主要是為了讓注入時，能夠有正確的環境參數，如:exporter endpoint (OTEL Collector 服務）的位置，以及traceidratio的取樣比率 0.25等。Propagators主要當有產生所指定的軌跡Header時，(如：tracecontext (W3C)，或是b3(Zipkin)，Baggage的軌跡相關描述，必須被<a href=https://opentelemetry.io/docs/specs/otel/context/api-propagators/#propagators-distribution>保存並往後傳遞</a>。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-27>27</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span>cat &lt;&lt; EOF | kubectl apply -f -<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>opentelemetry.io/v1alpha1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>kind</span>:<span style=color:#bbb> </span>Instrumentation<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>metadata</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>my-instrumentation<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>spec</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>exporter</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>endpoint</span>:<span style=color:#bbb> </span>http://otel-collector.otel-collector.svc.cluster.local:4317<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>propagators</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- tracecontext<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- baggage<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- b3<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>sampler</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>type</span>:<span style=color:#bbb> </span>parentbased_traceidratio<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>argument</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;0.25&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>python</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#228b22># Needed until https://github.com/open-telemetry/opentelemetry-python-contrib/issues/1361</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#228b22># is fixed</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>OTEL_METRICS_EXPORTER<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>value</span>:<span style=color:#bbb> </span>none<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#228b22># Python autoinstrumentation only supports OTLP/HTTP which the collector runs on port 4318,</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#228b22># see https://github.com/open-telemetry/opentelemetry-operator/issues/924</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:#8b008b;font-weight:700>name</span>:<span style=color:#bbb> </span>OTEL_EXPORTER_OTLP_ENDPOINT<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#8b008b;font-weight:700>value</span>:<span style=color:#bbb> </span>http://otel-collector.otel-collector.svc.cluster.local:4318<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>EOF<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=部署測試用服務>部署測試用服務</h2><p>Create Artifact Docker Registry:
我們建置一個 my-repo 的Docker registry提供給Cloud run使用。我們同時設定讓本機可以存取Artifact Docker Registry(容器鏡像庫）。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>gcloud artifacts repositories create my-repo <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --repository-format=docker <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --location=asia-east1 <span style=color:#cd5555>\
</span></span></span><span style=display:flex><span><span style=color:#cd5555></span>    --async
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gcloud auth configure-docker asia-east1-docker.pkg.dev
</span></span></code></pre></td></tr></table></div></div><p>可以開一個新分頁，選擇Artifact Registry，查看剛剛我們通過CLI建置出來的my-repo鏡像庫。等等我們部署時會用到它，</p><h2 id=guestbook-backpy-的程式碼修改>GuestBook back.py 的程式碼修改</h2><p>這個Guestbook程式，具有frontend與backend兩塊，均包含在 src/檔案夾下。其中backend部分，主要負責API和與後端MongoDB溝通，而frontend主要是UI操作，通過使用者擊點留言，呼叫後端POST API。</p><p>我們首先針對backend 資料夾下的 back.py 與 requirements.txt 進行修改，為了引進prometheus的API的效能統計數值，因為我們使用的程式使用Flask框架，我們選擇引入：prometheus_flask_exporter，修改如下：</p><table><thead><tr><th>Filename</th><th>Fix Content</th><th>修改原因</th></tr></thead><tbody><tr><td><code>back.py</code></td><td>1. Import bleach下方，加上 <code>from prometheus_flask_exporter import PrometheusMetrics</code>. 2. <code>app = Flask(__name__)</code> 下方，加上 <code>metrics = PrometheusMetrics(app)</code></td><td>引入 prometheus metrics</td></tr><tr><td><code>requirements.txt</code></td><td>新增 <code>prometheus_flask_exporter</code> 在檔案最後</td><td></td></tr></tbody></table><h2 id=guestbook-開發部署的設定碼修改>GuestBook 開發+部署的設定碼修改</h2><p>主要的CI設定檔，在 frontend/ 和 backend/ 檔案夾內部的 Dockerfile, skaffold.yaml ，部署檔案則在各自 frontend/ 和backend檔案夾內的deployment.yaml。</p><p>請進行以下的置換，${PROJECT_ID}請更換為您專案的名稱 (e.g.: qwiklabs-gcp-00-bf7484a22018) :</p><ol><li>修改原因：鏡像位置，包含 skaffold.yaml 與 deployment.yaml</li></ol><p><code>${PROJECT_ID}</code> 替換成 <code>qwiklabs-gcp-01-0cda8821429a</code></p><table><thead><tr><th>Filename</th><th>Replace Location</th><th>Replace Content</th></tr></thead><tbody><tr><td><code>src/frontend/skaffold.yaml</code></td><td>build.artifacts.image</td><td>由 <code>python-guestbook-frontend</code> 改為 <code>asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook-frontend</code></td></tr><tr><td><code>src/backend/skaffold.yaml</code></td><td>build.artifacts.image</td><td>由 <code>python-guestbook-backend</code> 改為 <code>asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook-backend</code></td></tr><tr><td><code>src/frontend/kubernetes-manifests/guestbook-frontend.deployment.yaml</code></td><td>spec.template.spec.containers.image</td><td>由 <code>python-guestbook-frontend</code> 改為 <code>asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook-frontend</code></td></tr><tr><td><code>src/backend/kubernetes-manifests/guestbook-backend.deployment.yaml</code></td><td>spec.template.spec.containers.image</td><td>由 <code>python-guestbook-backendend</code> 改為 <code>asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook</code></td></tr></tbody></table><ol start=2><li>修改原因：通過新增Annotation，將Auto-Instrumentation的程式碼通過sidecar container注入容器</li></ol><table><thead><tr><th>Filename</th><th>Replace Location</th><th>Replace Content</th></tr></thead><tbody><tr><td><code>src/frontend/kubernetes-manifests/guestbook-frontend.deployment.yaml</code></td><td>spec.template.metadata</td><td>加上 &ldquo;img 1&rdquo;</td></tr><tr><td><code>src/backend/kubernetes-manifests/guestbook-backend.deployment.yaml</code></td><td>spec.template.metadata</td><td>加上 &ldquo;img 2&rdquo;</td></tr></tbody></table><p><img style=width:80% src=https://cdn.qwiklabs.com/GO8i8RM9YMSfhcqJP0xXVR6sDV0j9g%2Fj4xKfie2Pm3I%3D></img></p><p align=center><sub><sup>"img 1"</sup></sub></p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#8b008b;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>sidecar.opentelemetry.io/inject</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;true&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>prometheus.io/scrape</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;true&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>prometheus.io/path</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;/metrics&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>prometheus.io/port</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;8080&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>instrumentation.opentelemetry.io/inject-python</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;true&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><img style=width:80% src=https://cdn.qwiklabs.com/LwLcLiV1ygVXYxmWmWdlbACm%2FNkck5AhEvhTVXBEkSE%3D><p align=center><sub><sup>"img 2"</sup></sub></p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#8b008b;font-weight:700>annotations</span>:<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>sidecar.opentelemetry.io/inject</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;true&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>instrumentation.opentelemetry.io/inject-python</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;true&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><ol start=3><li>修改原因：基礎鏡像若為alpine-based，目前在Auto-Injection會有錯誤發生。</li></ol><table><thead><tr><th>Filename</th><th>Replace Location</th><th>Replace Content</th></tr></thead><tbody><tr><td><code>src/frontend/Dockerfile</code></td><td>第一行</td><td><code>FROM python:3.11-alpine</code> 改為 <code>FROM python:3.11-slim</code></td></tr><tr><td><code>src/backend/Dockerfile</code></td><td>第一行</td><td><code>FROM python:3.11-alpine</code> 改為 <code>FROM python:3.11-slim</code></td></tr></tbody></table><h2 id=skaffold-打包容器並部署服務>Skaffold 打包容器並部署服務</h2><p>由於Guestbook專案是由Cloud Code產生，裏面自然也繼承了Google對於CI/CD的堅持，通過 Skaffold 簡化整個容器開發流程，不用再通過 docker build, push 打包容器，也不再需要 kubectl 手動部署，所有的設定都濃縮在 skaffold.yaml 裡，有興趣的捧油可以參考 skaffold.yaml 的內容，如果想更了解，可以看 Skaffold 的網站</p><ul><li><a href=https://skaffold.dev/docs/builders/>Build</a></li><li><a href=https://skaffold.dev/docs/deployers/>Deploy</a>。</li></ul><p>我們可以在 guestbook-1 檔案夾下，通過以下指令快速打包容器，並部署服務到GKE上：</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-4>4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-5>5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#658b00>cd</span> ~/guestbook-1
</span></span><span style=display:flex><span>skaffold build --file-output ./out.json &amp;&amp; skaffold deploy --build-artifacts ./out.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 部署的過程中，可以留意以下訊息，可以了解 Auto-Instrumentation 是通過 init container 發動的。</span>
</span></span><span style=display:flex><span>Waiting <span style=color:#8b008b;font-weight:700>for</span> deployments to stabilize...
</span></span><span style=display:flex><span> - deployment/python-guestbook-frontend: waiting <span style=color:#8b008b;font-weight:700>for</span> init container opentelemetry-auto-instrumentation to start
</span></span></code></pre></td></tr></table></div></div><ul><li>Response 2024-10-24: 有時候執行一次會失敗, 再執行一次就好</li></ul><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-63>63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-64>64</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get ns
</span></span><span style=display:flex><span>NAME                            STATUS   AGE
</span></span><span style=display:flex><span>anthos-identity-service         Active   80m
</span></span><span style=display:flex><span>cert-manager                    Active   65m
</span></span><span style=display:flex><span>default                         Active   81m
</span></span><span style=display:flex><span>gke-managed-cim                 Active   80m
</span></span><span style=display:flex><span>gke-managed-system              Active   80m
</span></span><span style=display:flex><span>gmp-public                      Active   79m
</span></span><span style=display:flex><span>gmp-system                      Active   79m
</span></span><span style=display:flex><span>kube-node-lease                 Active   81m
</span></span><span style=display:flex><span>kube-public                     Active   81m
</span></span><span style=display:flex><span>kube-system                     Active   81m
</span></span><span style=display:flex><span>opentelemetry-operator-system   Active   64m
</span></span><span style=display:flex><span>otel-collector                  Active   64m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl get all
</span></span><span style=display:flex><span>NAME                                             READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod/python-guestbook-backend-f5797bf64-kcsf4     1/1     Running   <span style=color:#b452cd>0</span>          6m31s
</span></span><span style=display:flex><span>pod/python-guestbook-frontend-5798979774-78vfq   1/1     Running   <span style=color:#b452cd>0</span>          6m36s
</span></span><span style=display:flex><span>pod/python-guestbook-mongodb-57b9469ff5-twbp4    1/1     Running   <span style=color:#b452cd>0</span>          6m31s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)        AGE
</span></span><span style=display:flex><span>service/kubernetes                  ClusterIP      192.168.32.1     &lt;none&gt;         443/TCP        77m
</span></span><span style=display:flex><span>service/python-guestbook-backend    ClusterIP      192.168.32.144   &lt;none&gt;         8080/TCP       12m
</span></span><span style=display:flex><span>service/python-guestbook-frontend   LoadBalancer   192.168.32.237   35.189.161.8   80:30881/TCP   13m
</span></span><span style=display:flex><span>service/python-guestbook-mongodb    ClusterIP      192.168.32.196   &lt;none&gt;         27017/TCP      12m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                        READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span style=display:flex><span>deployment.apps/python-guestbook-backend    1/1     <span style=color:#b452cd>1</span>            <span style=color:#b452cd>1</span>           12m
</span></span><span style=display:flex><span>deployment.apps/python-guestbook-frontend   1/1     <span style=color:#b452cd>1</span>            <span style=color:#b452cd>1</span>           13m
</span></span><span style=display:flex><span>deployment.apps/python-guestbook-mongodb    1/1     <span style=color:#b452cd>1</span>            <span style=color:#b452cd>1</span>           12m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                                   DESIRED   CURRENT   READY   AGE
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-backend-86d4ccd755    <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>       8m42s
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-backend-c4b6b56fb     <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>       12m
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-backend-f5797bf64     <span style=color:#b452cd>1</span>         <span style=color:#b452cd>1</span>         <span style=color:#b452cd>1</span>       6m31s
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-frontend-5798979774   <span style=color:#b452cd>1</span>         <span style=color:#b452cd>1</span>         <span style=color:#b452cd>1</span>       6m36s
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-frontend-677564c4c    <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>       13m
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-frontend-76fc8b67b5   <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>       13m
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-frontend-7b45f984d5   <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>       8m46s
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-mongodb-57b9469ff5    <span style=color:#b452cd>1</span>         <span style=color:#b452cd>1</span>         <span style=color:#b452cd>1</span>       6m31s
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-mongodb-777cbb8d5b    <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>       8m41s
</span></span><span style=display:flex><span>replicaset.apps/python-guestbook-mongodb-bcb448b76     <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>         <span style=color:#b452cd>0</span>       12m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># Tags used in deployment:</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook-frontend -&gt; asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook-frontend:latest@sha256:4f60fcf58e57b8d46054b291eec2f2afc92500b9c2db753e800ddbeb4789b14a</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook-backend -&gt; asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/python-guestbook-backend:latest@sha256:2230b1786c7f68242b3ae82dac07993aca6e7395a74ddffbfa6daf76540658af</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Starting deploy...</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - deployment.apps/python-guestbook-frontend configured</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - service/python-guestbook-frontend configured</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Waiting for deployments to stabilize...</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - deployment/python-guestbook-frontend is ready.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Deployments stabilized in 3.273 seconds</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - deployment.apps/python-guestbook-backend configured</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - service/python-guestbook-backend configured</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - deployment.apps/python-guestbook-mongodb configured</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - service/python-guestbook-mongodb configured</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Waiting for deployments to stabilize...</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - deployment/python-guestbook-mongodb is ready. [1/2 deployment(s) still pending]</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - deployment/python-guestbook-backend: waiting for init container init-db-ready to start</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#     - pod/python-guestbook-backend-86d4ccd755-gghwc: waiting for init container init-db-ready to start</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#  - deployment/python-guestbook-backend is ready.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># Deployments stabilized in 18.656 seconds</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=製造-traffic>製造 Traffic</h2><p>我們可以連到Guestbook網站，進行幾個留言測試，Guestbook網站IP查詢可以使用以下命令：</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-3>3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get svc -l <span style=color:#00688b>tier</span>=frontend -o <span style=color:#00688b>jsonpath</span>=<span style=color:#cd5555>&#39;{.items[0].status.loadBalancer.ingress[0].ip}&#39;</span>; <span style=color:#658b00>echo</span>
</span></span><span style=display:flex><span><span style=color:#228b22># 35.189.161.8</span>
</span></span><span style=display:flex><span>=&gt; http://35.189.161.8/
</span></span><span style=display:flex><span><span style=color:#228b22># 不知道為什麼無痕視窗裡連不到, 一般的可以</span>
</span></span></code></pre></td></tr></table></div></div><p>進入Guestbook後，請多輸入幾筆留言，因為目前我們的Trace軌跡紀錄是以25%進行設定(四個軌跡紀錄一條）。</p><p>動腦題 - 試試將Trace紀錄頻率為100%</p><p>Answer:</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-18-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-18-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#8b008b;font-weight:700>argument</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;0.25&#34;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#8b008b;font-weight:700>=&gt; argument</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;1&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><img style=width:80% src=https://cdn.qwiklabs.com/sDTbkQYctZ5fTKSrgynqFqyo9ByNwSgRMuup8W1ioBk%3D><p align=center><sub><sup>動腦題 - 試試將Trace紀錄頻率為100%</sup></sub></p><h2 id=壓測-optional>壓測 (Optional)</h2><p>如果想看到比較多的軌跡以及Metrics，用手動留言應該是很痛苦的。這裡提供一個壓測工具Locust的快速教學，特別針對Cloud Shell的使用者，我們主要依照<a href=https://cloud.google.com/architecture/distributed-load-testing-using-gke>GCP建議的分散式測試</a>來實作這一段：</p><h3 id=下載分散式測試的git專案>下載分散式測試的Git專案</h3><p>將專案複製(Clone)到guestbook-1檔案夾下:</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#658b00>cd</span> ~/guestbook-1
</span></span><span style=display:flex><span>git clone https://github.com/GoogleCloudPlatform/distributed-load-testing-using-kubernetes.git
</span></span></code></pre></td></tr></table></div></div><h3 id=修改taskpy>修改task.py</h3><p>在Cloud Shell IDE裡，我們找到 <code>tasks.py</code> ，並以下方的測試腳本取代原本的內容：</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-13>13</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8b008b;font-weight:700>from</span> <span style=color:#008b45;text-decoration:underline>locust</span> <span style=color:#8b008b;font-weight:700>import</span> HttpUser, task, between, events
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>import</span> <span style=color:#008b45;text-decoration:underline>random</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b008b;font-weight:700>class</span> <span style=color:#008b45;font-weight:700>QuickstartUser</span>(HttpUser):
</span></span><span style=display:flex><span>    wait_time = between(<span style=color:#b452cd>1</span>, <span style=color:#b452cd>5</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#707a7c>@task</span>(<span style=color:#b452cd>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>def</span> <span style=color:#008b45>get</span>(self):
</span></span><span style=display:flex><span>        self.client.get(<span style=color:#cd5555>&#34;/&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#707a7c>@task</span>(<span style=color:#b452cd>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#8b008b;font-weight:700>def</span> <span style=color:#008b45>titles</span>(self):
</span></span><span style=display:flex><span>        num = random.randint(<span style=color:#b452cd>1</span>, <span style=color:#b452cd>5</span>)
</span></span><span style=display:flex><span>        self.client.post(<span style=color:#cd5555>&#34;/post&#34;</span>, data={<span style=color:#cd5555>&#34;name&#34;</span>: <span style=color:#cd5555>&#34;sweet heart&#34;</span>, <span style=color:#cd5555>&#34;message&#34;</span>: <span style=color:#cd5555>f</span><span style=color:#cd5555>&#34;test message </span><span style=color:#cd5555>{</span>num<span style=color:#cd5555>}</span><span style=color:#cd5555>&#34;</span>})
</span></span></code></pre></td></tr></table></div></div><h3 id=修改kubernetes-config下的模板>修改kubernetes-config下的模板</h3><p>由於我們的專案與Git的稍許不同，我們需要先針對原始的範本（template）檔案進行兩個修改。</p><p>首先找到 <code>distributed-load-testing-using-kubernetes/kubernetes-config/</code> 目錄，修改：</p><ol><li><code>locust-master-service.yaml.tpl</code> 中：移除</li></ol><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-1>1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-2>2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#228b22>#移除以下的兩行，將原本的Internal Balancer部署為External LB</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#8b008b;font-weight:700>annotations</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#8b008b;font-weight:700>networking.gke.io/load-balancer-type</span>:<span style=color:#bbb> </span><span style=color:#cd5555>&#34;Internal&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><ol start=2><li>底下兩個檔案 <code>locust-worker-controller.yaml.tpl</code> 與 <code>locust-master-controller.yaml.tpl</code> 中：</li></ol><p>將 <code>value: https://${SAMPLE_APP_TARGET}</code> 改為 <code>value: ${SAMPLE_APP_TARGET}</code></p><h3 id=產生部署檔案並通過skaffold部署>產生部署檔案，並通過skaffold部署</h3><p>接下來，我們來產生部署Locust測試用的k8s-manifests的檔案。</p><p>將以下的執行檔，進行變數更換後，新增到 <code>distributed-load-testing-using-kubernetes/docker-image</code> 目錄下，命名為 <code>gen-locust-k8s-manifests.sh</code></p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-14>14</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#1e889b>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#1e889b></span><span style=color:#658b00>export</span> <span style=color:#00688b>LOCUST_IMAGE_NAME</span>=locust-tasks
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>LOCUST_IMAGE_TAG</span>=latest
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>GKE_CLUSTER</span>=gke-lt-cluster
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>PROJECT</span>=<span style=color:#cd5555>&#34;qwiklabs-gcp-01-0cda8821429a&#34;</span>
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>AR_REPO</span>=my-repo
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>REGION</span>=asia-east1
</span></span><span style=display:flex><span><span style=color:#658b00>export</span> <span style=color:#00688b>SAMPLE_APP_TARGET</span>=<span style=color:#cd5555>&#34;http://python-guestbook-frontend.default.svc&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p k8s-manifests/
</span></span><span style=display:flex><span>envsubst &lt; ../kubernetes-config/locust-master-controller.yaml.tpl &gt; k8s-manifests/master-controller.yaml
</span></span><span style=display:flex><span>envsubst &lt; ../kubernetes-config/locust-worker-controller.yaml.tpl &gt; k8s-manifests/worker-controller.yaml
</span></span><span style=display:flex><span>envsubst &lt; ../kubernetes-config/locust-master-service.yaml.tpl &gt; k8s-manifests/master-service.yaml
</span></span></code></pre></td></tr></table></div></div><p>我們在Terminal中，切換到 <code>distributed-load-testing-using-kubernetes/docker-image</code> 目錄下，使用 <code>bash gen-locust-k8s-manifests.sh</code> 我們就在 <code>k8s-manifests</code> 目錄產生好所需的部署檔案。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-10>10</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#658b00>cd</span> ~/guestbook-1/distributed-load-testing-using-kubernetes/docker-image
</span></span><span style=display:flex><span>bash gen-locust-k8s-manifests.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ls -lah k8s-manifests
</span></span><span style=display:flex><span><span style=color:#228b22># total 20K</span>
</span></span><span style=display:flex><span><span style=color:#228b22># drwxrwxr-x 2 student_03_c40dfb54bf6e student_03_c40dfb54bf6e 4.0K Oct 24 01:59 .</span>
</span></span><span style=display:flex><span><span style=color:#228b22># drwxrwxr-x 5 student_03_c40dfb54bf6e student_03_c40dfb54bf6e 4.0K Oct 24 01:59 ..</span>
</span></span><span style=display:flex><span><span style=color:#228b22># -rw-rw-r-- 1 student_03_c40dfb54bf6e student_03_c40dfb54bf6e 1.6K Oct 24 01:59 master-controller.yaml</span>
</span></span><span style=display:flex><span><span style=color:#228b22># -rw-rw-r-- 1 student_03_c40dfb54bf6e student_03_c40dfb54bf6e 1.3K Oct 24 01:59 master-service.yaml</span>
</span></span><span style=display:flex><span><span style=color:#228b22># -rw-rw-r-- 1 student_03_c40dfb54bf6e student_03_c40dfb54bf6e 1.3K Oct 24 01:59 worker-controller.yaml</span>
</span></span></code></pre></td></tr></table></div></div><p>這時，按下 skaffold init，並在選擇中按下Yes，我們就可以得到完整的部署程式skaffold.yaml，最後使用前面學到的大絕招：</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-18>18</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>skaffold init
</span></span><span style=display:flex><span><span style=color:#228b22># y</span>
</span></span><span style=display:flex><span><span style=color:#228b22># apiVersion: skaffold/v4beta11</span>
</span></span><span style=display:flex><span><span style=color:#228b22># kind: Config</span>
</span></span><span style=display:flex><span><span style=color:#228b22># metadata:</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#   name: docker-image</span>
</span></span><span style=display:flex><span><span style=color:#228b22># build:</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#   artifacts:</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#     - image: asia-east1-docker.pkg.dev/qwiklabs-gcp-01-0cda8821429a/my-repo/locust-tasks</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#       docker:</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#         dockerfile: Dockerfile</span>
</span></span><span style=display:flex><span><span style=color:#228b22># manifests:</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#   rawYaml:</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#     - k8s-manifests/master-controller.yaml</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#     - k8s-manifests/master-service.yaml</span>
</span></span><span style=display:flex><span><span style=color:#228b22>#     - k8s-manifests/worker-controller.yaml</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>skaffold build --file-output ./out.json &amp;&amp; skaffold deploy --build-artifacts ./out.json
</span></span></code></pre></td></tr></table></div></div><h3 id=檢視locust的壓測ui>檢視Locust的壓測UI</h3><p>skaffold deploy結束後，我們應該可以看到 locust-master 跟5台 locust-slave pods 都成功在 default namespace 被部署出來。這時，我們尋找<code>service/locust-master-web</code> 的 <code>EXTERNAL-IP</code> 位置（下圖為例是 35.234.5.131）</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-20>20</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl get svc,pods
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                TYPE           CLUSTER-IP       EXTERNAL-IP    PORT(S)             AGE
</span></span><span style=display:flex><span>service/kubernetes                  ClusterIP      192.168.32.1     &lt;none&gt;         443/TCP             109m
</span></span><span style=display:flex><span>service/locust-master               ClusterIP      192.168.32.209   &lt;none&gt;         5557/TCP,5558/TCP   66s
</span></span><span style=display:flex><span>service/locust-master-web           LoadBalancer   192.168.32.94    35.234.5.131   8089:31909/TCP      65s
</span></span><span style=display:flex><span>service/python-guestbook-backend    ClusterIP      192.168.32.144   &lt;none&gt;         8080/TCP            44m
</span></span><span style=display:flex><span>service/python-guestbook-frontend   LoadBalancer   192.168.32.237   35.189.161.8   80:30881/TCP        45m
</span></span><span style=display:flex><span>service/python-guestbook-mongodb    ClusterIP      192.168.32.196   &lt;none&gt;         27017/TCP           44m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME                                             READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>pod/locust-master-5bf5779498-nr45b               1/1     Running   <span style=color:#b452cd>0</span>          65s
</span></span><span style=display:flex><span>pod/locust-worker-5c68d58f49-7cnzk               1/1     Running   <span style=color:#b452cd>0</span>          65s
</span></span><span style=display:flex><span>pod/locust-worker-5c68d58f49-f47mh               1/1     Running   <span style=color:#b452cd>0</span>          65s
</span></span><span style=display:flex><span>pod/locust-worker-5c68d58f49-gx46w               1/1     Running   <span style=color:#b452cd>0</span>          65s
</span></span><span style=display:flex><span>pod/locust-worker-5c68d58f49-kq525               1/1     Running   <span style=color:#b452cd>0</span>          65s
</span></span><span style=display:flex><span>pod/locust-worker-5c68d58f49-l2ftp               1/1     Running   <span style=color:#b452cd>0</span>          65s
</span></span><span style=display:flex><span>pod/python-guestbook-backend-f5797bf64-kcsf4     1/1     Running   <span style=color:#b452cd>0</span>          37m
</span></span><span style=display:flex><span>pod/python-guestbook-frontend-5798979774-78vfq   1/1     Running   <span style=color:#b452cd>0</span>          38m
</span></span><span style=display:flex><span>pod/python-guestbook-mongodb-57b9469ff5-twbp4    1/1     Running   <span style=color:#b452cd>0</span>          37m
</span></span></code></pre></td></tr></table></div></div><p>打開網站連到 <a href=http://35.234.5.131:8089>http://35.234.5.131:8089</a> 我們將壓測 Number of users 改為 100, Spawn rate改為 5 按下Start swarming</p><img style=width:80% src=https://cdn.qwiklabs.com/s1Dqj1WZA5VhLGDLFT4BQ0I%2BIpfS7hMbWdoAr5B1R9E%3D><p>我們可以看到壓測開始發生，同時壓測的負載均勻的分散到各個 worker 節點上。</p><img style=width:80% src=https://cdn.qwiklabs.com/rhy0he8RvdjeoATLW%2B8etvmleRKKfUp0iLSxQ9Jz8UQ%3D><h2 id=檢視監控結果>檢視監控結果</h2><p>在Cloud Console，選取 <a href=https://console.cloud.google.com/traces/list>Cloud Trace的頁面</a>，我們會先看到上方有一些小點 (1)，每個點都是被紀錄的呼叫軌跡，值得一提的是，我們是一行程式都沒有修正，就可以取得這個資訊。</p><p>點開小點之後，我們可以看到呼叫的軌跡，其中我們特別選擇 <code>guestbook.insert</code> 這一條，因為這條表示的是插入 MongoDB 所需的時間。相較於 istio side-car 的 Trace 軌跡，使用 OpenTelemetry，更強化了對『非』Restful 後端的支持，</p><img style=width:80% src=https://cdn.qwiklabs.com/XXdPs3VA0Mfc941Ojg2K%2Bzyh63NGUNa1t7C%2Ffm%2BpmjA%3D><p>我們可以先進入 <code>backend-guestbook</code> 的 Pod 裡，通過 <code>apt update && apt-get install -y curl</code>， 再通過</p><p>curl 8080 port 的 /metrics subpath，了解目前 prometheus-flask-exporter 提供的相關參數(如下）：主要包含 python garbage collector, process_cpu等運算資源的狀況，以及flask_http_request_duration的histogram 以及flask_http_request_total 針對不同status code (e.g. 201, 403, 415等）的分項統計。</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-63>63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-64>64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-65>65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-66>66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-67>67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-68>68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-69>69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-70>70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-71>71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-72>72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-73>73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-74>74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-75>75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-76>76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-77>77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-78>78</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl <span style=color:#658b00>exec</span> -it pod/python-guestbook-backend-f5797bf64-kcsf4 -- apt update &amp;&amp; sudo apt-get install -y curl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl <span style=color:#658b00>exec</span> -it pod/python-guestbook-backend-f5797bf64-kcsf4 -- curl localhost:8080/metrics
</span></span><span style=display:flex><span><span style=color:#228b22># error: Internal error occurred: Internal error occurred: error executing command in container: failed to exec in container: failed to start exec &#34;de2767b1591bf31152cf2e0aff32436233db0a7a63b640fb874170f7c6c3b21b&#34;: OCI runtime exec failed: exec failed: unable to start container process: exec: &#34;curl&#34;: executable file not found in $PATH: unknown</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl localhost:8080/metrics
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># HELP python_gc_objects_collected_total Objects collected during gc</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE python_gc_objects_collected_total counter</span>
</span></span><span style=display:flex><span>python_gc_objects_collected_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;0&#34;</span>} 86241.0
</span></span><span style=display:flex><span>python_gc_objects_collected_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;1&#34;</span>} 9378.0
</span></span><span style=display:flex><span>python_gc_objects_collected_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;2&#34;</span>} 495.0
</span></span><span style=display:flex><span><span style=color:#228b22># HELP python_gc_objects_uncollectable_total Uncollectable objects found during GC</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE python_gc_objects_uncollectable_total counter</span>
</span></span><span style=display:flex><span>python_gc_objects_uncollectable_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;0&#34;</span>} 0.0
</span></span><span style=display:flex><span>python_gc_objects_uncollectable_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;1&#34;</span>} 0.0
</span></span><span style=display:flex><span>python_gc_objects_uncollectable_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;2&#34;</span>} 0.0
</span></span><span style=display:flex><span><span style=color:#228b22># HELP python_gc_collections_total Number of times this generation was collected</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE python_gc_collections_total counter</span>
</span></span><span style=display:flex><span>python_gc_collections_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;0&#34;</span>} 536.0
</span></span><span style=display:flex><span>python_gc_collections_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;1&#34;</span>} 48.0
</span></span><span style=display:flex><span>python_gc_collections_total{<span style=color:#00688b>generation</span>=<span style=color:#cd5555>&#34;2&#34;</span>} 2.0
</span></span><span style=display:flex><span><span style=color:#228b22># HELP python_info Python platform information</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE python_info gauge</span>
</span></span><span style=display:flex><span>python_info{<span style=color:#00688b>implementation</span>=<span style=color:#cd5555>&#34;CPython&#34;</span>,major=<span style=color:#cd5555>&#34;3&#34;</span>,minor=<span style=color:#cd5555>&#34;11&#34;</span>,patchlevel=<span style=color:#cd5555>&#34;6&#34;</span>,version=<span style=color:#cd5555>&#34;3.11.6&#34;</span>} 1.0
</span></span><span style=display:flex><span><span style=color:#228b22># HELP process_virtual_memory_bytes Virtual memory size in bytes.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE process_virtual_memory_bytes gauge</span>
</span></span><span style=display:flex><span>process_virtual_memory_bytes 5.24079104e+08
</span></span><span style=display:flex><span><span style=color:#228b22># HELP process_resident_memory_bytes Resident memory size in bytes.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE process_resident_memory_bytes gauge</span>
</span></span><span style=display:flex><span>process_resident_memory_bytes 6.1812736e+07
</span></span><span style=display:flex><span><span style=color:#228b22># HELP process_start_time_seconds Start time of the process since unix epoch in seconds.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE process_start_time_seconds gauge</span>
</span></span><span style=display:flex><span>process_start_time_seconds 1.6964357322e+09
</span></span><span style=display:flex><span><span style=color:#228b22># HELP process_cpu_seconds_total Total user and system CPU time spent in seconds.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE process_cpu_seconds_total counter</span>
</span></span><span style=display:flex><span>process_cpu_seconds_total 13.49
</span></span><span style=display:flex><span><span style=color:#228b22># HELP process_open_fds Number of open file descriptors.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE process_open_fds gauge</span>
</span></span><span style=display:flex><span>process_open_fds 11.0
</span></span><span style=display:flex><span><span style=color:#228b22># HELP process_max_fds Maximum number of open file descriptors.</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE process_max_fds gauge</span>
</span></span><span style=display:flex><span>process_max_fds 1.048576e+06
</span></span><span style=display:flex><span><span style=color:#228b22># HELP flask_exporter_info Information about the Prometheus Flask exporter</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE flask_exporter_info gauge</span>
</span></span><span style=display:flex><span>flask_exporter_info{<span style=color:#00688b>version</span>=<span style=color:#cd5555>&#34;0.22.4&#34;</span>} 1.0
</span></span><span style=display:flex><span><span style=color:#228b22># HELP flask_http_request_duration_seconds Flask HTTP request duration in seconds</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE flask_http_request_duration_seconds histogram</span>
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.005&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 597.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.01&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 599.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.025&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 599.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.05&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 599.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.075&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.1&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.25&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.5&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;0.75&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;1.0&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;2.5&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;5.0&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;7.5&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;10.0&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_bucket{<span style=color:#00688b>le</span>=<span style=color:#cd5555>&#34;+Inf&#34;</span>,method=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_duration_seconds_count{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;POST&#34;</span>,path=<span style=color:#cd5555>&#34;/messages&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0# HELP flask_http_request_duration_seconds_created Flask HTTP request duration in seconds
</span></span><span style=display:flex><span><span style=color:#228b22># HELP flask_http_request_total Total number of HTTP requests</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE flask_http_request_total counter</span>
</span></span><span style=display:flex><span>flask_http_request_total{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;POST&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 600.0
</span></span><span style=display:flex><span>flask_http_request_total{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;GET&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 1415.0
</span></span><span style=display:flex><span>flask_http_request_total{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;POST&#34;</span>,status=<span style=color:#cd5555>&#34;404&#34;</span>} 34.0
</span></span><span style=display:flex><span>flask_http_request_total{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;POST&#34;</span>,status=<span style=color:#cd5555>&#34;415&#34;</span>} 2.0
</span></span><span style=display:flex><span><span style=color:#228b22># HELP flask_http_request_created Total number of HTTP requests</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE flask_http_request_created gauge</span>
</span></span><span style=display:flex><span>flask_http_request_created{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;POST&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 1.696435753173088e+09
</span></span><span style=display:flex><span>flask_http_request_created{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;GET&#34;</span>,status=<span style=color:#cd5555>&#34;201&#34;</span>} 1.6964357532112405e+09
</span></span><span style=display:flex><span>flask_http_request_created{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;POST&#34;</span>,status=<span style=color:#cd5555>&#34;404&#34;</span>} 1.6964396226003044e+09
</span></span><span style=display:flex><span>flask_http_request_created{<span style=color:#00688b>method</span>=<span style=color:#cd5555>&#34;POST&#34;</span>,status=<span style=color:#cd5555>&#34;415&#34;</span>} 1.696439633466002e+09
</span></span><span style=display:flex><span><span style=color:#228b22># HELP flask_http_request_exceptions_total Total number of HTTP requests which resulted in an exception</span>
</span></span><span style=display:flex><span><span style=color:#228b22># TYPE flask_http_request_exceptions_total counter</span>
</span></span></code></pre></td></tr></table></div></div><p>接下來我們點選<a href=https://console.cloud.google.com/monitoring/metrics-explorer>Monitoring頁面</a>，依照上述的metrics輸出，我們用關鍵字 flask快速找到相關統計，已經被收容到Google Managed Prometheus內。</p><img style=width:80% src=https://cdn.qwiklabs.com/jQ6Zzu%2F%2FS7P6k65GN76xssP2%2FzQUqsLO58MB590mqgA%3D><p>我們也可以通過UI 在GroupBy的地方，針對不同的Status (error code), tier, method等，進行相關的統計。</p><img style=width:80% src=https://cdn.qwiklabs.com/NZ9Tq9jlLFtIC%2FsMbRndrXv7pQWikCBTTW7x9UZi1Gg%3D><p>這個OpenTelemetry的Lab，希望讓你感受到OpenTelemetry的威力。在不需要任何額外手動添加程式下，我們得到了完整的Trace軌跡，讓開發者可以更容易的找到連線之間的bottleneck，相較於另一類的無侵入式監控工具：Istio-Proxy，OpenTelemetry對非Restful後台，有較好的支援性。同時，通過Proemtheus-Flask-Exporter的函式庫，我們可以通過新增兩行程式碼，就可以得到完整的http連線統計，這些資料都妥善的儲存在GCP的Managed Service中，免除了存儲規劃，或是軟體升級等維運需要。</p><h3 id=2024-10-24-issue>2024-10-24 Issue</h3><ul><li>curl 安裝了但是 curl 不出來</li><li>Metrics 搜尋不到 flask: 要搜 prometheus > python</li></ul><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-30>30</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>kubectl <span style=color:#658b00>exec</span> -it pod/python-guestbook-backend-f5797bf64-kcsf4
</span></span><span style=display:flex><span>apt update &amp;&amp; sudo apt-get install -y curl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#228b22># 直接這樣很容易 $PATH 有問題: kubectl exec -it pod/python-guestbook-backend-f5797bf64-kcsf4 -- /bin/bash -c apt update &amp;&amp; sudo apt-get install -y curl</span>
</span></span><span style=display:flex><span>Defaulted container <span style=color:#cd5555>&#34;backend&#34;</span> out of: backend, init-db-ready (init), opentelemetry-auto-instrumentation-python (init)
</span></span><span style=display:flex><span>Hit:1 http://deb.debian.org/debian bookworm InRelease
</span></span><span style=display:flex><span>Hit:2 http://deb.debian.org/debian bookworm-updates InRelease
</span></span><span style=display:flex><span>Get:3 http://deb.debian.org/debian-security bookworm-security InRelease [48.0 kB]
</span></span><span style=display:flex><span>Fetched 48.0 kB in 0s (<span style=color:#b452cd>123</span> kB/s)    
</span></span><span style=display:flex><span>Reading package lists... Done
</span></span><span style=display:flex><span>Building dependency tree... Done
</span></span><span style=display:flex><span>Reading state information... Done
</span></span><span style=display:flex><span>All packages are up to date.
</span></span><span style=display:flex><span>********************************************************************************
</span></span><span style=display:flex><span>You are running apt-get inside of Cloud Shell. Note that your Cloud Shell  
</span></span><span style=display:flex><span>machine is ephemeral and no system-wide change will persist beyond session end. 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To suppress this warning, create an empty ~/.cloudshell/no-apt-get-warning file.
</span></span><span style=display:flex><span>The <span style=color:#658b00>command</span> will automatically proceed in <span style=color:#b452cd>5</span> seconds or on any key. 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Visit https://cloud.google.com/shell/help <span style=color:#8b008b;font-weight:700>for</span> more information.                 
</span></span><span style=display:flex><span>********************************************************************************
</span></span><span style=display:flex><span>Reading package lists... Done
</span></span><span style=display:flex><span>Building dependency tree... Done
</span></span><span style=display:flex><span>Reading state information... Done
</span></span><span style=display:flex><span>curl is already the newest version (8.5.0-2ubuntu10.4).
</span></span><span style=display:flex><span><span style=color:#b452cd>0</span> upgraded, <span style=color:#b452cd>0</span> newly installed, <span style=color:#b452cd>0</span> to remove and <span style=color:#b452cd>2</span> not upgraded.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl <span style=color:#658b00>exec</span> -it pod/python-guestbook-backend-f5797bf64-kcsf4 -- <span style=color:#658b00>echo</span> <span style=color:#00688b>$PATH</span>
</span></span><span style=display:flex><span>/opt/gradle/bin:/opt/maven/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/go/bin:/usr/local/node_packages/node_modules/.bin:/usr/local/rvm/bin:/google/go_appengine:/google/google_appengine:/home/student_03_c40dfb54bf6e/.gems/bin:/usr/local/rvm/bin:/home/student_03_c40dfb54bf6e/gopath/bin:/google/gopath/bin:/google/flutter/bin:/usr/local/nvm/versions/node/v20.18.0/bin:/usr/bin
</span></span></code></pre></td></tr></table></div></div><h2 id=結束lab>結束Lab</h2><p>關閉Lab，或是執行以下命令清除Lab</p><div class=highlight><div style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#eed;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sh data-lang=sh><span style=display:flex><span>gcloud projects delete <span style=color:#00688b>$PROJECT_ID</span>
</span></span></code></pre></td></tr></table></div></div><iframe class=LikeCoin height=235 src="https://button.like.co/in/embed/androchentw/button?referrer=https%3a%2f%2fblog.androchen.tw%2ftech%2ftech-event%2f2024-k8s-summit-workshop%2fgcp-otel%2f" width=100% frameborder=0></iframe><hr><section id=social-share><div class="list-inline footer-links"><div class=share-box aria-hidden=true><ul class=share><li><a href="//twitter.com/share?url=https%3a%2f%2fblog.androchen.tw%2ftech%2ftech-event%2f2024-k8s-summit-workshop%2fgcp-otel%2f&amp;text=&amp;via=ProgramMurTw" target=_blank title="Share on Twitter"><i class="fab fa-twitter"></i></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.androchen.tw%2ftech%2ftech-event%2f2024-k8s-summit-workshop%2fgcp-otel%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook"></i></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fblog.androchen.tw%2ftech%2ftech-event%2f2024-k8s-summit-workshop%2fgcp-otel%2f&amp;title=" target=_blank title="Share on Reddit"><i class="fab fa-reddit"></i></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.androchen.tw%2ftech%2ftech-event%2f2024-k8s-summit-workshop%2fgcp-otel%2f&amp;title=" target=_blank title="Share on LinkedIn"><i class="fab fa-linkedin"></i></a></li><li><a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fblog.androchen.tw%2ftech%2ftech-event%2f2024-k8s-summit-workshop%2fgcp-otel%2f&amp;title=" target=_blank title="Share on StumbleUpon"><i class="fab fa-stumbleupon"></i></a></li><li><a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fblog.androchen.tw%2ftech%2ftech-event%2f2024-k8s-summit-workshop%2fgcp-otel%2f&amp;description=" target=_blank title="Share on Pinterest"><i class="fab fa-pinterest"></i></a></li></ul></div></div></section></article><ul class="pager blog-pager"><li class=previous><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gke-chatbot/ data-toggle=tooltip data-placement=top title>&larr; 上一篇</a></li><li class=next><a href=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-genai-cloud-run/ data-toggle=tooltip data-placement=top title>下一篇 &rarr;</a></li></ul><div class=disqus-comments><button id=show-comments class="btn btn-default" type=button>顯示 <span class=disqus-comment-count data-disqus-url=https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-otel>則評論</span></button><div id=disqus_thread></div><script type=text/javascript>var disqus_config=function(){this.page.url="https://blog.androchen.tw/tech/tech-event/2024-k8s-summit-workshop/gcp-otel"}</script></div></div></div></div><footer class=post-footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><iframe src=https://programmur.substack.com/embed width=100% height=320 style="border:1px solid #eee;background:#fff" frameborder=0 scrolling=no></iframe><div><br></div><ul class="list-inline text-center footer-links"><li><a href=mailto:programmur.tw@gmail.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.facebook.com/ProgramMur title=Facebook><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/androchentw title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://twitter.com/ProgramMurTw title=Twitter><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/androchen title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://www.instagram.com/ProgramMur title=Instagram><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-instagram fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted"><a href=https://blog.androchen.tw/>androchentw</a>
&nbsp;&bull;&nbsp;&copy;
2024
&nbsp;&bull;&nbsp;
<a href=https://blog.androchen.tw/>ProgramMur - 程序猿碎念</a></p><p class="credits theme-by text-muted">由 <a href=https://gohugo.io>Hugo v0.136.4</a> 提供 &nbsp;&bull;&nbsp; 主題 <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> 移植自 <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
&nbsp;&bull;&nbsp;[<a href=be79f39877bd3c172da321121648881f0adceff5>be79f398</a>]</p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=https://blog.androchen.tw/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://blog.androchen.tw/js/load-photoswipe.js></script><script>(function(){var t,n="212df771d70ae0521",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>$(function(){$("#show-comments").on("click",function(){var e="androchenblog";(function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//"+e+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)})(),$(this).hide()})})</script><script id=dsq-count-scr src=//androchenblog.disqus.com/count.js async></script><div class=back-to-top id=back-to-top><i class="fas fa-angle-double-up"></i></div></body></html>